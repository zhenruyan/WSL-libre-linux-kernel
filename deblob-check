#! /bin/sh

# deblob-check version 2009-03-09
# Inspired in gNewSense's find-firmware script.
# Written by Alexandre Oliva <lxoliva@fsfla.org>

# Check http://www.fsfla.org/svn/fsfla/software/linux-libre for newer
# versions.

# Copyright 2008, 2009 Alexandre Oliva <lxoliva@fsfla.org>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301
# USA


# usage: deblob-check [-S] [-vv] [-s S] [-lDdBbCcXxPpFftVh?H] \
#        *.tar* patch-* [-i prefix/] *.patch *.diff...

# Look for and report too-long undocumented sequences of numbers
# (generally blobs in disguise) in source files, as well as requests
# for loading non-Free firmware.

# The order of command line flags is significant.  Flags given out of
# the order above won't be handled correctly, sorry.

# -s --sensitivity: must be followed by a blank and a number.
#		Specifies the number of consecutive integral or
#		character constants that trigger the blob detector.

#    --reverse-patch: Test the removed parts of a patch, rather than
#		the added ones.

# The default sensitivity is 32 constants.

# The sensitivity, if present, must be the first option.  The action
# selection, if present, must be the first argument, except for the
# sensitivity and verbosity.

# The default can be overridden with one of:

# -l --list-blobs: list files that contain sequences that match the
#		blob detector test and that are not known to be false
#		positives.  This is the default option.

# -d --deblob --mark-blobs: print the processed input, replacing
#		sequences that match the blob detector test and that
#		are NOT known to be false positives with
#		/*(DEBLOBBED)*/.

# -D --cat: print the processed input, as it would have been fed to
#		the blob detector script.  Use -S to save the sed
#		script used to process it, and search for `sedcat:' in
#		comments to locate the relevant adaptation points.

# -b --print-marked-blobs: like -d, but print only the matching
#		sequences.

# -B --print-blobs: like -b, but do not deblob the sequences.

# -c --print-marked-blobs-with-context: like -b, but try to maximize
#		the context around the blobs.  This maximization will
#		sometimes disregard known false positives, if they
#		happen to be contained within the extended match.
#		This is probably an indication that the false positive
#		matching rule could be improved.

# -C --print-blobs-with-context: like -B, but try to maximize the
#		context around the blobs.

# -X --print-all-matches: print all blobs, be they known false
#		positives or blobs.

# -x --list-all-matches: list files that contain sequences that appear
#		to be blobs, be they known false positives or not.

# -p --mark-false-positives: print the processed input, replacing
#		sequences that match the blob detector test, but that
#		are known to be false positives, with /*(DEBLOBBED)*/.

# -P --list-false-positives: list files that contain false positives.

# -f --print-marked-false-positives: like -p, but print only the
#		matching sequences.

# -F --print-false-positives: like -f, but do not deblob the sequences.

# -t --test: run (very minimal) self-test.

# -V --version: print a version number

# -h -? -H --help: print short or long help message


# debugging options:

# -S --save-scripts: save scripts and temporary files.

# -v --verbose: increase verbosity level, for internal debugging.  May
#		be given at most twice.


# file options:

# --: Don't process command-line options any further.  All following
#		arguments are taken as filenames.

# -i --implied-prefix --prefix: prepend the given prefix to each filename
#		listed after this option, when configuring false positives
#		and negatives.

# *.tar*: iterate over all files in the named tar file.

# *.patch, patch-*, *.diff: Look for blobs in the [ +] parts of the
# 		*patch, unless --reverse-patch is given, in which case
# 		the [ -] parts will be used.

# Anything else is assumed to be a source file.

# *.gz | *.bz2: Decompress automatically.


# The exit status is only significant for the --list options: it will
# be true if nothing was found, and false otherwise.

: # Mark the end of the help message.

# TODO:

# - Improve handling of command-line arguments, so as to not make the
# order relevant.

# - Add an option for the user to feed their own false positive
# patterns.

# - Add support to recognize known blobs (or other non-Free
# signatures, really), to speed up the scanning of files containing
# blobs, and to avoid attempts to disguise blobs.

# - Factor out the code in the various print_* and list_* parts of the
# sed script, at least in the shell sources.  Make sure they're all
# included and expanded in a saved --cat script though.

# - Add support for file name tagging in patterns, such that blobs or
# false positives are recognized only when handling the specific
# filename, be it stand-alone, as part of a patch or a tarball.  This
# should help avoid recognition of actual blobs as false positives
# just because there's a symbol with a different name elsewhere.

#   It is convenient that the patterns provided by the user to
# recognize file names can be empty (for backward compatibility), but
# this should ideally be phased out in favor of more precise matches.
# It's important that files can be recognized with leading tarball or
# patch names, that the filename used within the tarball contain
# leading garbage, and even that a partial pathname be recognizable
# (say recognize drivers/net/whatever.c when the input file is named
# ../net/whatever.c).

#   Rather than using regular expressions to recognize multiple files
# it's convenient (but not quite essential) that filename patterns be
# specifiable as regular expressions, rather than simple filenames,
# but there are other ways around this.

#   Maintaining begin/end markers in a stack-like fashion as part of
# the processed stream, and using the names in them as (optional) part
# of the recognition patterns, would enable us to do it.

#   Introducing annotations next to the false positives (and recognized
# blobs) as an early part of the process may speed things up and
# enable fast processing, but how to introduce the annotations quickly
# in the first place?  Given patterns such as

#   \(\(file1\)\(.*\)\(pat1\)\|\(file2\)\(.*\)\(pat2\)\|...\)

# how do we get sed to introduce a marker that contains file2 right
# before or right after pat2, without turning a big efficient regexp
# into a slowish sequence of s/// commands?

# - Re-check and narrow false-positive patterns to make sure they
# apply only to the relevant content.

# - Scripting abilities, so as to be able to automate the removal of
# source files or of blobs from source files in a tarball without
# having to extract the entire tarball (as in tar --update/--delete)
# would be nice.  Carrying over removed files automatically into
# patches would also be great, and this sort of script would be
# perfect to document what has been done to a tarball plus a set of
# patches.  Something like deblob.script:
#
#   tarball linux-2.6.24.tar.bz2
#   delete net/wireloss/freedom.c drivers/me/crazy.c
#   deblob include/linux/slab-blob-kfree.h
#   deconfig drivers/char/drm DRM_IS_BAD
#
#   patch patch-2.6.25-rc7.bz2
#   delete arch/power/over/you.c

# such that the deletes from an earlier file would carry over into the
# subsequent ones, and new tarballs and patch files would be generated
# with the libre- prefix in their basename, and the xdeltas between
# the original files and the modified files would be minimal, and
# redundant with this script and the input script while at that.

# - Improve documentation of the code.

# - Write a decent testsuite.

# - Insert your idea here. :-)

# Yeah, lots of stuff to do.  Want to help?

# This makes it much faster, and mostly immune to non-ASCII stuff, as
# long as a 8-bit-safe sed is used.  Probably a safe assumption these
# days.
case ${LANG+set} in set) LANG=C; export LANG;; esac

rm="rm -f"
case $1 in
--save-scripts | -S)
  shift
  rm="echo preserving"
  ;;
esac

# Choose verbosity level for sed script debugging and performance
# analysis.
case $1 in
--verbose | -v)
  shift
  case $1 in
  --verbose | -v)
    shift
    v="i\\
:
p;
i\\
"
    ;;
  *)
    v="P;i\\
"
    ;;
  esac
  ;;
*) 
  v="# "
  ;;
esac

sens=31 # 32 - 1
case $1 in
--sensitivity | -s)
  sens=$2;
  shift 2 || exit 1

  if test "$sens" -gt 0 2>/dev/null; then
    :
  else
    echo invalid sensitivity: $sens >&2
    exit 1
  fi

  sens=`expr $sens - 1`
  ;;
esac

reverse_patch=false
case $1 in
--reverse-patch)
  reverse_patch=:
  shift;
  ;;
esac

prefix=/
case $1 in
--implied-prefix | --prefix| -i)
  prefix=$2
  case $prefix in
  /*/) ;;
  */) prefix=/$prefix ;;
  /*) prefix=$prefix/ ;;
  *) prefix=/$prefix/ ;;
  esac
  shift 2 || exit 1
  ;;
esac

test_mode=false

name=deblob-check

case $1 in
--version | -V)
  sed '/^# '$name' version /,/^# Written by/ { s/^# //; p; }; d' < $0
  exit 0
  ;;

-\? | -h)
  sed -n '/^# usage:/,/# -h/ { /^# -/,/^$/{s/^# \(-.*\):.*/\1/p; d; }; s/^\(# \?\)\?//p; }' < $0 &&
  echo
  echo "run \`$name --help | more' for full usage"
  exit 0
  ;;

--help | -H)
  sed -n '/^# '$name' version /,/^[^#]/ s/^\(# \?\)\?//p' < $0
  exit 0
  ;;

--test | -t)
  test_mode=:
  ;;

--mark-false-positives | -p)
  shift;
  set_sed_cmd () {
    set_sedmain "b list_both;" "p;" "b list_matches;"
  }
  ;;

--print-marked-false-positives | -f)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_marked_matches;" "" "b print_marked_matches;"
  }
  ;;

--print-false-positives | -F)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_matches;" "" "b print_matches;"
  }
  ;;

--deblob | --mark-blobs | -d)
  shift;
  set_sed_cmd () {
    set_sedmain "b list_blobs;" "p;" "p;"
  }
  ;;

--cat | -D)
  shift;
  set_sed_cmd () {
    set_sedmain \
      "# sedcat: Actual blob detected, but there may be false positives." \
      "# sedcat: No blob whatsoever found." \
      "# sedcat: False positives found." \
      "p; d; # sedcat: Just print stuff, remove this line to run the actual script."
  }
  ;;

--print-marked-blobs | -b)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_marked_blobs;"
  }
  ;;

--print-blobs | -B)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_blobs;"
  }
  ;;

--print-marked-blobs-with-context | -c)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_marked_cblobs;"
  }
  ;;

--print-blobs-with-context | -C)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_cblobs;"
  }
  ;;

--list-false-positives | -P)
  shift;
  set_sed_cmd () {
    set_sedmain "" "" "
i\\
$file
q 1;"
  }
  ;;

--list-all-matches | -x)
  shift;
  set_sed_cmd () {
    set_sedmain "
i\\
$file
q 1;" "" "
i\\
$file
q 1;"
  }
  ;;

--print-all-matches | -X)
  shift;
  set_sed_cmd () {
    set_sedmain "b print_both;" "" "b print_matches;"
  }
  ;;

*)
  case $1 in
  -l | --list-blobs) shift;;
  esac
  case $1 in
  -- | --implied-prefix | --prefix | -i) ;;
  -*)
    if test ! -f "$1"; then
      echo "$name: \`$1' given too late or out of the proper sequence." >&2
      echo "$name: The order of arguments is significant, see the usage." >&2
      exit 1
    fi
    ;;
  esac
      
  set_sed_cmd () {
    set_sedmain "
i\\
$file
q 1;"
  }
  ;;

esac

case $1 in
--)
  sawdashdash=t
  shift;;
esac

if $test_mode; then
  pass=:

  # Exercise some nasty inputs to see that we recognize them as blobs
  # with full context.
  for string in \
    "1,2,3,4" \
    "= {
1, 0x2, 03, L'\x4'
}" \
    "=
{
  '\\x1', '\\002'
  ,
  {
    { \"\\x3\", },
    \"\\004\"
  },
};" \
    ".long 1,2
     .long \$3,\$4" \
    "#define X { 1, 2, \\
		 3, 4, /* comment */ \\
	       }" \
  "= {
/*
 * multi-line
 * comment
 */
 {
   0x4c00c000, 0x00000000, 0x00060000, 0x00000000,
 },
}" \
  ; do
    case `echo "$string" | $0 -s 4 -c` in
    "::: - :::
$string") ;;
    *) echo "failed positive test for:
$string" >&2
       pass=false;;
    esac
  done

  # Make sure we do not recognize these as blobs.
  for string in \
    "#define X { 1, 2 }
#define Y { 3, 4 }" \
    " 0x00, 0x00, 0x00 " \
  ; do
    case `echo "$string" | $0 -s 4` in
    "") ;;
    *) echo "failed negative test for:
$string" >&2
       pass=false;;
    esac
  done

  # How did we do?
  if $pass; then
    echo success
  fi

  $pass
  exit
fi

# Call addx as needed to set up more patterns to be recognized as
# false positives.  Takes the input filename in $1.

set_except () {
  # Look for a multi-line definition starting with a line that matches
  # $1 (implicitly anchored to the beginning of the line), and ending
  # at the first ';'.  $2 may optionally name the files in which this
  # match is to be disregarded as a potential blob.
  initnc () {
    addx "$1[^;]*;\\?" $2
  }

  # Same as initnc, but require the terminating semicolon.
  defsnc () {
    addx "$1[^;]*;" $2
  }

  # Look for a multi-line definition starting with a line that matches
  # $1 (implicitly anchored to the beginning of the line), and ending
  # at the first ';' that's not within comments.
  initc () {
    addx "$1\\([^;]*\\|$comment\\)*;\\?" $2
  }

  # Accept as a non-blob an expression $1 that would have otherwise
  # triggered blob detection.  The expression must end in a way that
  # would trigger the blob detection machinery.
  accept () {
    addx "$1" $2
  }

  # Match up to the end a comment started in $1.
  ocomment () {
    addx "$1[/]*\\([^/]\\|[^*/][/]*\\)*[*][/]" $2
  }

  # Match $1 followed by backslash-terminated lines and a last
  # non-backslash-terminated line.
  oprepline () {
    addx "$1\\([^\\n]*\\\\[\\n]\\)*[^\\n\\\\]*$eol" $2
  }

  # Match $1 in $2 as a blob.  Not anchored.
  blobna () {
    badx "$1" $2
  }

  # Match $1 as a blob anywhere.  $2 is just for documentation purposes.
  blobname () {
    badx "$1"
  }

  # Match $1 in $2 as a blob.  The expectation is a match in the
  # beginning of line, but we don't do anchoring of blob patterns ATM.
  blob () {
    badx "$1" $2
  }

  blobna "request_firmware_nowait"
  blobna "request_firmware"
  blobna "request_ihex_firmware"
  blobna "MODULE_FIRMWARE[ 	\n]*([^;]*)[ 	\n]*;\([ 	\n]*MODULE_FIRMWARE[ 	\n]*([^;]*)[ 	\n]*;\)*"
  blobna "DEFAULT_FIRMWARE"

  case $prefix$1 in
  */*linux*.tar* | */*kernel*.tar* | */*linux-*.*.*/*)
    # false alarms, contain source
    # drivers/net/wan/wanxlfw.inc_shipped -> wanxlfw.S
    accept 'static u8 firmware\[\]={[\n]0x60,\(0x00,\)*0x16,\(0x00,\)*\([\n]\(0x[0-9A-F][0-9A-F],\)*\)*[\n]0x23,0xFC,0x00,0x00,0x00,0x01,0xFF,0xF9,0x00,0xD4,0x61,0x00,0x06,0x74,0x33,0xFC,\([\n]\(0x[0-9A-F][0-9A-F],\)*\)*0x00[\n]};'
    # drivers/usb/serial/xircom_pgs_fw.h -> xircom_pgs.S
    initnc 'static const struct ezusb_hex_record xircom_pgs_firmware\[\] ='
    # drivers/usb/serial/keyspan_pda_fw_h -> keyspan_pda.S
    initnc 'static const struct ezusb_hex_record keyspan_pda_firmware\[\] ='
    # arch/m68k/ifpsp060/*.sa -> src/*.s
    accept '	\.long	0x60ff0000,0x02360000,0x60ff0000,0x16260000[\n]'"$sepx$blobpat*"
    accept '	\.long	0x60ff0000,0x17400000,0x60ff0000,0x15f40000[\n]'"$sepx$blobpat*"
    # arch/powerpc/platforms/cell/spufs/spu_save_dump.h_shipped -> spu_save.c
    initnc 'static unsigned int spu_save_code\[\]  __attribute__((__aligned__(128))) ='
    # arch/powerpc/platforms/cell/spufs/spu_restore_dump.h_shipped -> spu_restore.c
    initnc 'static unsigned int spu_restore_code\[\]  __attribute__((__aligned__(128))) ='
    # drivers/net/ixp2000/ixp2400_tx.ucode -> ixp2400_tx.uc
    initnc '	\.initial_reg_values	= (struct ixp2000_reg_value \[\]) {'
    # drivers/net/ixp2000/ixp2400_rx.ucode -> ixp2400_rx.uc
    initnc '	\.initial_reg_values	= (struct ixp2000_reg_value \[\]) {'


    # checked:

    accept '	\$3 = {{pge = {{ste = {\(\([0-9][0-9a-fx{},\n 	]*\|\(pge\|ste\) =\|<repeats [0-9]\+ times>\)[{},\n 	]*\)*<repeats 11 times>}'"$eol"
    accept '__clz_tab:[\n]	\.byte	0\(,[0-5]\)\+'"$sepx$blobpat*" arch/sparc/lib/divdi3.S
    accept 'PITBL:[\n]  \.long  0xC0040000,0xC90FDAA2,'"$blobpat*" arch/sparc/lib/divdi3.S
    accept '\(0x[0F][0F],\)\+\\[\n]\(\(0x[0F][0F],\)\+\\[\n]\)*\(0x[0F][0F],\)\+0x00' arch/m68k/mac/mac_penguin.S
    accept '\.lowcase:[\n]	\.byte 0x00\(,0x0[1-7]\)\+'"$sepx$blobpat*$eol" arch/s390/kernel/head.S
    accept '_zb_findmap:[\n]         \.byte  0\(,[123],0\)\+,4'"$sepx$blobpat*$eol" arch/s390/kernel/bitmap.S
    accept '_sb_findmap:[\n]         \.byte  8\(,0,[123]\)\+,0'"$sepx$blobpat*$eol" arch/s390/kernel/bitmap.S
    accept '	\.section __ex_table,"a"'"$sepx$blobpat*" arch/powerpc/lib/copyuser_64.S
    accept '	memcpy(src, "\\x01\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00".*PROGxxxx' arch/powerpc/platforms/iseries/mf.c
    initnc 'static const unsigned int cpu_745x\[2\]\[16\] =' arch/ppc/platforms/ev64260.c
    initnc 'const unsigned char __flsm1_tab\[256\] =' arch/alpha/lib/fls.c
    accept '#define _MAP_0_32_ASCII_SEG7_NON_PRINTABLE	\\[\n]	\(0,\)\+'"$eol" 'drivers/input/misc/map_to_7segment\.h\|include/linux/map_to_7segment\.h'
    initc '	static int      init_values_b\[\] =' sound/oss/ad1848.c
    initnc 'static unsigned char atkbd_set2_keycode\[512\] =' drivers/input/keyboard/atkbd.c
    accept 'desc_config1:[\n]	\.byte 0x09, 0x02'"$sepx$blobpat*" 'drivers/usb/serial/\(keyspan_pda\|xircom_pgs\).S'
    accept 'string_mfg:[\n]\?\(;\?	\.byte[^\n]*[\n]\)\+string_mfg_end:' 'drivers/usb/serial/\(keyspan_pda\|xircom_pgs\).S'
    accept 'string_product:[\n]\?\(;\?	\.byte[^\n]*[\n]\)\+string_product_end:' 'drivers/usb/serial/\(keyspan_pda\|xircom_pgs\).S'
    accept '   [/][*] \(SQCIF\|QSIF\|QCIF\|SIF\|CIF\|VGA\) [*][/][\n]   {[\n]      {'"$blobpat*" drivers/media/video/pwc/pwc-nala.h
    accept 'P[13]\([\n]#[^\n]*\)*[\n]*\([\n][0-9 ]*\)\+' drivers/video/logo/*.ppm
    accept 'for i in [ 	0-9\\\n]*[\n]do' 'Documentation/specialix\.txt|Documentation/serial/specialix\.txt'
    accept '         :   3600000   3400000   3200000   3000000   2800000 ' Documentation/cpu-freq/cpufreq-stats.txt
    accept '00 00[\n]64 01[\n]8e 0b[\n][\n][0-9a-f \n]*fe fe' 'Documentation/scsi/\(sym\|ncr\)53c8xx_2.txt'
    accept '0f 00 08 08 64 00 0a 00 - id 0[\n]'"$blobpat*" 'Documentation/scsi/\(sym\|ncr\)53c8xx_2.txt'
    accept 'default nvram data:'"$sepx$blobpat*" 'Documentation/scsi/\(sym\|ncr\)53c8xx_2.txt'
    accept '0x0458     0x7025[\n]'"$blobpat*" Documentation/video4linux/sn9c102.txt
    accept '0x102c     0x6151[\n]'"$blobpat*" Documentation/video4linux/et61x251.txt
    accept '0x041e     0x4017[\n]'"$blobpat*" Documentation/video4linux/zc0301.txt
    accept '  (gdb) x\/100x \$25[\n]  0x507d2434:     0x507d2434      0x00000000      0x08048000      0x080a4f8c'"$sepx$blobpat*" Documentation/uml/UserModeLinux-HOWTO.txt
    accept '      1  0  0  0  0x308'"$sepx$blobpat*" Documentation/isdn/README.inc
    accept 'domain<N> <cpumask> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36'"$eol" Documentation/sched-stats.txt
    accept '[ *	]*0                   1                   2                   3[\n][ *	]*0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1' 'net/\(netfilter\|ipv4\)/ipvs/ip_vs_sync.c|net/sctp/sm_make_chunk.c|include/linux/scpt.h'
    accept ' \*  1 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0' arch/x86/lguest/boot.c
    ocomment '	[/][*] Configure the PCI bus bursts and FIFO thresholds.' drivers/net/fealnx.c
    ocomment '[/][*] the original LUT values from Alex van Kaam <darkside@chello\.nl>' drivers/hwmon/via686a.c
    initc 'static const unsigned char init\[\] = {[^;]*MODE=0 ;.*SAA_7114_NTSC_HSYNC_START' drivers/media/video/saa7114.c

    defsnc 'static struct cipher_testvec \(aes\|anubis\|bf\|camellia\|cts_mode\|des3_ede\|cast6\|salsa20_stream\|serpent\|tf\|tnepres\|xeta\|x\?tea\)\(_\(cbc\|ctr\|xts\)\)\?_\(enc\|dec\)_tv_template\[\] =' 'crypto/\(tcrypt\|testmgr\).h'
    defsnc 'static struct comp_testvec \(deflate\|lzo\)_\(de\)\?comp_tv_template\[\] =' 'crypto/\(tcrypt\|testmgr\).h'
    defsnc 'static struct hash_testvec \(aes_xcbc128\|crc32c\|hmac_sha2\(24\|56\)\|\(sha\|wp\)\(256\|384\|512\)\)_tv_template\[\] =' 'crypto/\(tcrypt\|testmgr\).h'
    # initnc '[ 	]*\.\(digest\|entries\|input\|key\|output\|plaintext\|result\)[ \n	]*= [{"]' 'crypto/\(tcrypt\|testmgr\).h'

    defsnc 'static \(const \)\?RegInitializer initData\[\] __initdata =' 'drivers/ide/ali14xx\.c\|drivers/ide/legacy/ali14xx\.c'
    defsnc 'static const u8 setup\[\] =' 'drivers/ide/delkin_cb\.c\|drivers/ide/pci/delkin_cb\.c'
    defsnc 'static u8 cvs_time_value\[\]\[XFER_UDMA_6 - XFER_UDMA_0 + 1\] =' 'drivers/ide/sis5513\.c\|drivers/ide/pci/sis5513\.c'
    defsnc 'static u8 \(act\|ini\|rco\)_time_value\[\]\[8\] =' 'drivers/ide/sis5513\.c\|drivers/ide/pci/sis5513\.c'
    defsnc 'static const u8 speedtab \[3\]\[12\] =' 'drivers/ide/umc8672\.c\|drivers/ide/legacy/umc8672\.c'
    defsnc 'static const s8 \(b43\(\|legacy\)\|bcm43xx\)_tssi2dbm_[bg]_table\[\] =' net/wireless/b43/phy.c
    defsnc 'static const char zr360[56]0_dht\[0x1a4\] =' 'drivers/media/video/zr36060\.c\|drivers/media/video/zoran/zr36060\.c'
    defsnc 'static const char zr360[56]0_dqt\[0x86\] =' 'drivers/media/video/zr36060\.c\|drivers/media/video/zoran/zr36060\.c'
    defsnc 'static u8 tas3004_treble_table\[\] =' sound/aoa/codecs/tas-basstreble.h

    # This file contains firmwares that we deblob with high
    # sensitivity, so make sure the sequences of numbers that are not
    # blobs are not deblobbed.  FIXME: we should have patterns to
    # recognize the blobs instead.
    defsnc '	static const u32 test_pat\[4\]\[6\] =' drivers/net/tg3.c
    accept "	}\\(,\\? mem_tbl_5\\(70x\\|705\\|755\\|906\\)\\[\\] = {$sepx$blobpat*$sepx}\\)*;" drivers/net/tg3.c

    # end of generic checked expressions.
    # version-specific checked bits start here

    # removed in 2.6.28
    defsnc 'static unsigned char irq_xlate\[32\] =' arch/sparc/kernel/sun4m_irq.c
    defsnc 'static int logitech_expanded_keymap\[LOGITECH_EXPANDED_KEYMAP_SIZE\] =' drivers/hid/hid-input.c
    initnc '	static const __u8 \(read_indexs\|n\(set\)\?[0-9]*\|missing\)\[[0-9x]*\] =' drivers/media/video/gspca/t613.c
    defsnc 'static const u_char nand_ecc_precalc_table\[\] =' drivers/mtd/nand/nand_ecc.c
    oprepline '#define AR5K_RATES_\(11[ABG]\|TURBO\|XR\) ' drivers/net/wireless/ath5k/ath5k.h
    defsnc 'static const struct ath_hal ar5416hal =' drivers/net/wireless/ath9k/hw.c
    defsnc 'const unsigned char INIT_2\[127\] =' drivers/video/omap/lcd_sx1.c

    # removed in 2.6.24
    accept " Psize    Ipps       Tput     Rxint     Txint    Done     Ndone[\\n] ---------------------------------------------------------------\\([\\n][ 0-9]\\+\\)\\+$eol"
    initnc 'static u_short ataplain_map\[NR_KEYS\] __initdata ='
    initnc '	static const unsigned char invert5\[\] ='
    initnc 'static unsigned char alpa2target\[\] ='
    initnc 'static unsigned char target2alpa\[\] ='
    oprepline '#define INIT_THREAD [{0},]\+[ 	]*\\[\n][ 	]*[{0},]\+'
    initnc 'static uint tas300\(1c\|4\)_\(master\|mixer\|treble\|bass\)_tab\[\]='
    initnc 'static short dmasound_[au]law2dma16\[\] ='
    initnc 'static const unsigned short DACVolTable\[101\] ='

    # removed in 2.6.23
    initnc 'static const UQItype __clz_tab\[\] =' arch/arm26/lib/udivdi3.c
    initnc '	static unsigned char scale\[101\] =' sound/oss/opl3sa2.c
    initnc '} syncs\[\] =' drivers/scsi/53c7xx.c
    initnc 'genoa_md:'"$sepx$blobpat*"'[\n]	\.ascii	"Genoa"' arch/i386/boot/video.S

    # removed in 2.6.22
    initnc 'Vendor ID  Product ID[\n]-\+  -\+[\n]'"$blobpat*" Documentation/video4linux/sn9c102.txt
    defsnc 'static short [au]law2dma16\[\]' arch/ppc/8xx_io/cs4218_tdm.c
    defsnc '	static const char minimal_ascii_table\[\]' drivers/ieee1394/csr1212.c
    defsnc 'static u16 key_map \[256\] =' drivers/media/dvb/ttpci/av7110_ir.c
    defsnc 'static unsigned char gf64_inv\[64\] =' drivers/mtd/nand/cafe_ecc.c
    defsnc 'static unsigned short err_pos_lut\[4096\] =' drivers/mtd/nand/cafe_ecc.c
    defsnc 'static unsigned char testdata\[TESTDATA_LEN\] =' fs/jffs2/comprtest.c

    # added in 2.6.25
    accept "%canned_values = ([\\n]	\\([0-9]\\+ => \\[[ 	\\n]\\+\\(\\([0-9]\\+\\|'0x[0-9a-f]\\+'\\),[ 	\\n]*\\)*\\]\\(, \\|[\\n]\\)\\)*);"

    # from 2.6.25-rc* patches
    initnc '	int bcomm_irq\[3\*16\] ='
    initnc '	static const int8 countLeadingZerosHigh\[\] ='
    initnc 'static struct nic_qp_map nic_qp_mapping_[01]\[\] ='
    initnc 'static struct regval ov_initvals\[\] ='
    initnc 'static struct regval stk1125_initvals\[\] ='
    initnc 'static u8 bnx2x_stats_len_arr\[BNX2X_NUM_STATS\] ='
    initnc 'static const struct arb_line read_arb_data\[NUM_RD_Q\]\[MAX_RD_ORD + 1\] ='
    initnc 'static const struct arb_line write_arb_data\[NUM_WR_Q\]\[MAX_WR_ORD + 1\] ='
    initnc '		} blinkrates\[\] ='
    initnc 'static const struct ath5k_ini ar5212_ini\[\] ='
    initnc 'static const struct ath5k_ini_mode rf5413_ini_mode_end\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5111\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5112\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5112a\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5413\[\] ='
    initnc 'const u\(8\|16\|32\) b43_ntab_\(\(adjustpower\|estimatepowerlt\|gainctl\|iqlt\|loftlt\|noisevar1\|tdi[24]0a\)[01]\|channelest\|frame\(lookup\|struct\)\|mcs\|pilot\|tdtrn\|tmap\)\[\] ='

    # new in 2.6.26
    initnc 'static u64 vec2off\[68\] =' arch/ia64/kvm/process.c
    initnc "			interrupts = <\\(0x\\)\\?3 \\(0x\\)\\?0 \\(0x\\)\\?0  $blobpat*>;" 'arch/powerpc/boot/dts/\(cm5200\|lite5200b\?\|kuroboxHG\|pcm030\|tqm5200\).dts'
    initnc 'static const u32 crctab32\[\] =' arch/x86/boot/tools/build.c
    initnc 'static struct mse2snr_tab \(vsb\|qam\(64\|256\)\)_mse2snr_tab\[\] =' drivers/media/dvb/frontends/au8522.c
    initnc '} \(VSB\|QAM\)_mod_tab\[\] =' drivers/media/dvb/frontends/au8522.c
    initnc '} itd1000_\(lpf_pga\|fre_values\)\[\] =' drivers/media/dvb/frontends/itd1000.c
    initnc '} \(vsb\|qam\(64\|256\)\)_snr_tab\[\] =' drivers/media/dvb/frontends/s5h1411.c
    initnc '} snr_tab\[\] =' drivers/media/dvb/frontends/tda10048.c
    initnc 'static u32 reg_init_initialize\[\] =' drivers/media/video/saa717x.c
    initnc 'static const u32 \(main\|gear\)_seedset\[BACKOFF_SEEDSET_ROWS\]\[BACKOFF_SEEDSET_LFSRS\] =' drivers/net/forcedeth.c
    initnc 'static const struct ath5k_ini_mode rf24\(13\|25\)_ini_mode_end\[\] =' drivers/net/wireless/ath5k/initvals.c
    initnc 'static const u16 wm9713_reg\[\] =' sound/soc/codecs/wm9713.c

    # new in 2.6.27
    accept '	\.section __ex_table,"a"'"$sepx$blobpat*" 'arch/x86/lib/copy_user_\(nocache_\)\?64.S'
    accept 'desc_config1:[\n]	\.byte 0x09, 0x02'"$sepx$blobpat*" 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).S'
    accept 'string_mfg:[\n]\?\(;\?	\.byte[^\n]*[\n]\)\+string_mfg_end:' 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).S'
    accept 'string_product:[\n]\?\(;\?	\.byte[^\n]*[\n]\)\+string_product_end:' 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).S'
    accept ':03000000020200F9[\n]:040023000205\(9B0037\|5F0073\)[\n]\(:050030000000000000CB[\n]\|:0400430002010000B6[\n]\)*'"$sepx$blobpat*"'[\n]:\(0E06E0006400670065007400060334003700F4\|0606A000060334003700E0\)[\n]:00000001FF' 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).HEX'
    accept ':100000000C004000000000000000000000000000A4[\n]'"$sepx$blobpat*"'[\n]\/\* DSP56001 bootstrap code \*\/' firmware/dsp56k/bootstrap.bin.ihex
    initnc 'static const u16 uda1380_reg\[UDA1380_CACHEREGNUM\] =' sound/soc/codecs/uda1380.c
    initnc 'static const u16 wm8510_reg\[WM8510_CACHEREGNUM\] =' sound/soc/codecs/wm8510.c
    initnc 'static const unsigned short atkbd_set[23]_keycode\[512\] =' drivers/input/keyboard/atkbd.c
    initnc 'static const unsigned short atkbd_unxlate_table\[128\] =' drivers/input/keyboard/atkbd.c
    initnc 'static const unsigned char usb_kbd_keycode\[256\] =' drivers/hid/usbhid/usbkbd.c
    initnc '		u8 buf, bufs\[\] =' drivers/media/dvb/dvb-usb/cxusb.c
    initnc 'static struct dvb_pll_desc [^\n]* =' drivers/media/dvb/frontends/dvb-pll.c
    initnc '	static int sysdiv_to_div_x_2\[\] =' arch/powerpc/platforms/512x/clock.c
    defsnc 'static const __u8 cx_inits_\(176\|320\|352\|640\)\[\] =' drivers/media/video/gspca/conex.c
    defsnc 'static const __u8 cx_jpeg_init\[\]\[8\] =' drivers/media/video/gspca/conex.c
    defsnc 'static const __u8 cxjpeg_\(640\|352\|320\|176\|qtable\)\[\]\[8\] =' drivers/media/video/gspca/conex.c
    initnc 'static const unsigned char quant\[\]\[0x88\] =' drivers/media/video/gspca/jpeg.h
    initnc 'static unsigned char huffman\[\] =' drivers/media/video/gspca/jpeg.h
    initc '	\?static const struct ov_i2c_regvals norm_76[1247]0\[\] =' drivers/media/video/gspca/ov519.c
    initnc 'static const __u8 pac207_sensor_init\[\]\[8\] =' drivers/media/video/gspca/pac207.c
    initnc 'static const __u8 pac7311_jpeg_header\[\] =' drivers/media/video/gspca/pac7311.c
    initnc 'static const __u8 \(start\|page[34]\)_73\(02\|11\)\[\] =' drivers/media/video/gspca/pac7311.c
    initnc 'static const __u8 init\(Hv7131\|Ov\(6650\|7630\(_3\)\?\)\|Pas\(106\|202\)\|Tas51[13]0\)\[\] =' drivers/media/video/gspca/sonixb.c
    initnc 'static const __u8 \(hv7131\|ov\(6650\|7630\(_3\)\?\)\|pas\(106\|202\)\|tas51[13]0\)_sensor_init\(_com\)\?\[\]\[8\] =' drivers/media/video/gspca/sonixb.c
    defsnc 'static \(const \)\?__u8 \(hv7131r\|mi0360\|mo4000\|ov76\([36]0\|48\)\|om6802\)_sensor_init\[\]\[8\] =' drivers/media/video/gspca/sonixj.c
    initnc 'static const __u8 qtable4\[\] =' drivers/media/video/gspca/sonixj.c
    initnc 'static const __u16 \(spca500_visual\|Clicksmart510\)_defaults\[\]\[3\] =' drivers/media/video/gspca/spca500.c
    initnc 'static const __u8 qtable_\(creative_pccam\|kodak_ez200\|pocketdv\)\[2\]\[64\] =' drivers/media/video/gspca/spca500.c
    initnc 'static const __u16 spca501c\?_\(\(3com\|arowana\|mysterious\)_\)\?\(init\|open\)_data\[\]\[3\] =' drivers/media/video/gspca/spca501.c
    initnc 'static const __u16 spca505b\?_\(init\|open\)_data\(_ccd\)\?\[\]\[3\] =' drivers/media/video/gspca/spca505.c
    initnc 'static const __u16 spca508\(cs110\|_sightcam2\?\|_vista\)\?_init_data\[\]\[3\] =' drivers/media/video/gspca/spca508.c
    initnc 'static const __u16 spca561_init_data\[\]\[2\] =' drivers/media/video/gspca/spca561.c
    initnc 'static const __u16 spca504\(_pccam600\|A_clicksmart420\)_\(init\|open\)_data\[\]\[3\] =' drivers/media/video/gspca/sunplus.c
    initnc 'static const __u8 qtable_\(creative_pccam\|spca504_default\)\[2\]\[64\] =' drivers/media/video/gspca/sunplus.c
    initnc 'static const __u8 \(effects\|gamma\)_table\[\(MAX_[A-Z]*\|[A-Z]*_MAX\)\]\[[0-9]*\] =' drivers/media/video/gspca/t631.c
    initnc 'static const __u8 tas5130a_sensor_init\[\]\[8\] =' drivers/media/video/gspca/t613.c
    initc 'static const __u8 \(mi13[12]0\|po3130\|hv7131r\|ov76[67]0\)_\(\(soc\)\?initQ\?VGA_\(JPG\|data\)\|rundata\)\[\]\[4\] =' drivers/media/video/gspca/vc032x.c
    initnc 'static const struct usb_action \(cs2102\|hdcs2020xx\|icm105axx\|ov7630c\|pb0330[3x]x\)_Initial\(Scale\)\?\[\] =' drivers/media/video/gspca/zc3xx.c
    initnc 'static const u8 rtl8225z2_agc\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_ofdm\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_tx_power_cck\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_tx_power_cck_ch14\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const __u16 t10_dif_crc_table\[256\] =' lib/crc-t10dif.c
    initnc 'static crb_128M_2M_block_map_t crb_128M_2M_map\[64\] =' drivers/net/netxen/netxen_hw.c
    initnc 'static const __u16 crc10_table\[256\] =' drivers/usb/serial/safe_serial.c
    accept '[ 	]*\( *0\)*\( *1\)*[\n][ 	]*0 1 2 3 4 5 6 7 8 9 0 1 *2 3 4 5 6 7' Documentation/bt8xxgpio.txt
    initnc '	static int exp_lut\[256\] =' drivers/isdn/mISDN/dsp_audio.c
    initnc 'static const u32 bf_pbox\[16 \+ 2\] =' drivers/isdn/mISDN/dsp_blowfish.c
    initnc 'static const u32 bf_sbox\[256 \* 4\] =' drivers/isdn/mISDN/dsp_blowfish.c
    initnc 'static u8 sample_\(german_\(all\|old\)\|american_\(dialtone\|ringing\|busy\)\|special[123]\|silence\)\[\] =' drivers/isdn/mISDN/dsp_tones.c
    initnc 'struct pattern {[^}]*int tone;[^}]*} pattern\[\] =' drivers/isdn/mISDN/dsp_tones.c
    initnc 'static u8 \([au]\|_4\)law_to_\([ua]law\|4bit\)\[256\] =' drivers/isdn/mISDN/l1oip_codec.c
    initnc 'static unsigned char banner_table\[\] =' arch/sh/boards/mach-microdev/led.c
    initnc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static const \(yytype_u\?int\(8\|16\)\|\(unsigned \)\?\(short\( int\)\?\|char\)\) yy[^[]*\[\] =[*][/];' scripts/genksyms/parse.c_shipped
    accept 'irq_prio_\([hdl]\|l[cd]\):'"$sepx$blobpat*" arch/arm/inlcude/asm/hardware/entry-macro-iomd.S
    defsnc '	static const int desc_idx_table\[\] =' arch/arm/include/asm/hardware/iop3xx-adma.h
    defsnc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static const __u8 \(hv7131r\|mi0360\|mo4000\|ov76\(60\|48\)\)_sensor_init\[\]\[8\] = {[*][/];' drivers/media/video/gspca/sonixj.c
    defsnc 'static \(const \)\?u32 ar\(5416\|9280\)\(Modes\(_fast_clock\)\?\|Common\|BB_RfGain\|Bank6\(TPC\)\?\|Addac\)\(_91[06]0\(1_1\)\?\|_9280\(_2\)\?\)\?\[\]\[[236]\] =' drivers/net/wireless/ath9k/initvals.h

    # new in 2.6.28
    accept '\(static \)\?const char \(inv\)\?parity\[256\] = {[	 \n01,]*};' 'Documentation/mtd/nand_ecc\.txt\|drivers/mtd/nand/nand_ecc\.c'
    defsnc 'static const char \(bitsperbyte\|addressbits\)\[256\] =' drivers/mtd/nand/nand_ecc.c
    defsnc 'static struct pinmux_cfg_reg pinmux_config_regs\[\] =' arch/sh/kernel/cpu/sh2a/pinmux-sh7203.c
    defsnc '	static const u8 e_keymap\[\] =' drivers/hid/hid-lg.c
    defsnc '		*struct phy_reg phy_reg_init\(_[01]\)\?\[\] =' drivers/net/r8169.c
    defsnc 'DEFINE_DEFAULT_PDR(0x0161, 256,' drivers/net/wireless/hermes_dld.c
    defsnc 'static const int isink_cur\[\] =' drivers/regulator/wm8350-regulator.c
    defsnc 'static const s16 \(converge_speed_ipb\?\|LAMBDA_table\[4\]\)\[101\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static const u32 addrinctab\[33\]\[2\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static const u8 \(default_intra_quant_table\|\(val\|bits\)_[ad]c_\(lu\|chro\)minance\)\[\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static const int zz\[64\] =' drivers/staging/go7007/go7007-fw.c
    defsnc '	u16 pack\[\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static u8 \(initial\|channel\)_registers\[\] =' 'drivers/staging/go7007/wis-\(ov7640\|saa7113\|tw2804\).c'
    defsnc 'u16 MTO_One_Exchange_Time_Tbl_[ls]\[MTO_MAX_FRAG_TH_LEVELS\]\[MTO_MAX_DATA_RATE_LEVELS\] =' drivers/staging/winbond/mto.c
    defsnc 'u32 \(al2230_txvga_data\|w89rf242_txvga_old_mapping\)\[\]\[2\] =' drivers/staging/winbond/reg.c
    defsnc 'static const UINT16 crc16tab\[256\] =' drivers/staging/wlan-ng/hfa384x.c
    defsnc 'static const UINT32 wep_crc32_table\[256\] =' drivers/staging/wlan-ng/p80211wep.c
    defsnc 'static const unsigned char wm_vol\[256\] =' sound/pci/ice1712/phase.c
    defsnc 'static const u16 wm8900_reg_defaults\[WM8900_MAXREG\] =' sound/soc/wm8900.c
    defsnc '} \(clk_sys_ratios\|bclk_divs\)\[\] =' sound/soc/wm8903.c
    defsnc 'static u8 af9015_ir_table_\(leadtek\|twinhan\|a_link\|msi\|mygictv\|kworld\)\[\] =' drivers/media/dvb/dvb-usb/af9015.h
    defsnc 'static struct snr_table \(qpsk\|qam\(16\|64\)\)_snr_table\[\] =' drivers/media/dvb/frontends/af9013_priv.h
    defsnc 'static struct regdesc \(ofsm_init\|tuner_init_\(env77h11d5\|mt2060\(\|_2\)\|mxl500\(3d\|5\)\|qt1010\|mc44s803\|unknown\|tda18271\)\)\[\] =' drivers/media/dvb/frontends/af9013_priv.h
    defsnc 'static u8 stv0288_earda_inittab\[\] =' drivers/media/dvb/frontends/eds1547.h
    defsnc 'static u8 serit_sp1511lhb_inittab\[\] =' drivers/media/dvb/frontends/si21xx.c
    defsnc 'static u8 stv0288_inittab\[\] =' drivers/media/dvb/frontends/stv0288.c
    defsnc 'static const struct rf_channel rf_vals_b\[\] =' drivers/net/wireless/rt2x00/rt2400pci.c

    # request_firmware matches for 2.6.28
    accept 'D: Firmware loader (request_firmware)' CREDITS
    accept 'FIRMWARE LOADER (request_firmware)' MAINTAINERS
    accept '	- request_firmware() hotplug interface info.' Documentation/00-INDEX
    accept 'This driver requires a patch for firmware_class[^\n]*[\n]request_firmware_nowait function\.' Documentation/dell_rbu.txt
    accept ' request_firmware() hotplug interface:[\n] --*[\n].* - request_firmware_nowait() is also provided for convenience' Documentation/firmware_class/README
    accept 'Still, there are kernel threads that may want.*For example, if request_.*_firmware() will fail regardless' Documentation/power/freezing-of-tasks.txt
    accept 'Also, there may be some operations,.*calling request_firmware() from their .resume() routines' Documentation/power/notifiers.txt
    accept 'There is an USB interface for downloading[/]uploading.*request_firmware interface\.' Documentation/video4linux/si470x.txt
    accept '[\t]- move firmware loading to request_firmware()' drivers/staging/slicoss/README
    accept 'config FIRMWARE_IN_KERNEL.*let firmware be loaded from userspace\.' drivers/base/Kconfig
    accept 'static int[\n]_request_firmware(const struct firmware \*\*firmware_p, const char \*name,[^{]*[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/base/firmware_class.c
    accept 'static int[\n]request_firmware_work_func(void \*arg)[\n]{[\n]\([^}]\|[^\n}]}*\)*ret = _request_firmware(\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/base/firmware_class.c
    accept '[/][*][*][\n] [*] request_firmware: - send firmware [^{]*[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/base/firmware_class.c
    accept '[/][*][*][\n] [*] request_firmware_nowait: asynchronous version[^{]*[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/base/firmware_class.c
    accept 'EXPORT_SYMBOL(request_firmware\(_nowait\)\?);' drivers/base/firmware_class.c
    accept 'int request_firmware\(_nowait\)\?([^;]*);' include/linux/firmware.h
    accept 'static inline int request_firmware\(_nowait\)\?([^{]*)[\n]{[\n][\t]return -EINVAL;[\n]}[\n]' include/linux/firmware.h
    accept 'static inline int \(maybe_\)\?reject_firmware\(_nowait\)\?([^{;]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' include/linux/firmware.h

    accept 'static inline int request_ihex_firmware\?([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' include/linux/ihex.h
    ocomment '[/][*] Optional firmware\([^\n]*[\n] [*]\)*[^\n]* MODULE_FIRMWARE()'
    oprepline '#define MODULE_FIRMWARE(_firmware)' include/linux/module.h
    accept ' [*] Sample code on how to use request_firmware() from drivers\.' samples/firmware_class/firmware_sample_driver.c
    accept '[\t]\(retval\|error\) = request_firmware\(_nowait\)\?([^;]*"sample_driver_fw",[^;]*);' samples/firmware_class/firmware_sample_driver.c
    ocomment '	[/][*] request_firmware blocks until userspace finished' samples/firmware_class/firmware_sample_driver.c
    accept '		[ \t]*" request_firmware_nowait failed' samples/firmware_class/firmware_sample_driver.c

    # We used to remove these in early versions of Linux-libre.
    # They're now believed to be mere initialization data, rather than
    # code disguised as such, and they're not long enough so as to
    # render the software non-Free.
    defsnc 'static u8 tda10021_inittab\[0x40\]=' drivers/media/dvb/frontends/tda10021.c
    defsnc 'static u8 tda8083_init_tab \[\] =' drivers/media/dvb/frontends/tda8083.c
    defsnc 'static u8 ves1820_inittab\[\] =' drivers/media/dvb/frontends/ves1820.c
    defsnc 'static u8 init_1[89]93_w\?tab \?\[\] =' drivers/media/dvb/frontends/ves1x93.c
    defsnc 'static const u8 saa7113_tab\[\] =' drivers/media/dvb/ttpci/budget-av.c
    defsnc 'static u8 philips_sd1878_inittab\[\] =' drivers/media/dvb/ttpci/budget-av.c
    defsnc 'const struct Kiara_table_entry Kiara_table\[PSZ_MAX\]\[6\]\[4\] =' drivers/media/video/pwc/pwc-kiara.c
    defsnc 'const unsigned int KiaraRomTable \[8\]\[2\]\[16\]\[8\] =' drivers/media/video/pwc/pwc-kiara.c
    defsnc 'const struct Timon_table_entry Timon_table\[PSZ_MAX\]\[PWC_FPS_MAX_TIMON\]\[4\] =' drivers/media/video/pwc/pwc-timon.c
    defsnc 'const unsigned int TimonRomTable \[16\]\[2\]\[16\]\[8\] =' drivers/media/video/pwc/pwc-timon.c
    defsnc '	static const struct struct_initData initData\[\] =' drivers/media/video/usbvideo/ibmcam.c
    defsnc 'static const u8 rtl8187b_reg_table\[\]\[3\] =' drivers/net/wireless/rtl8187_dev.c
    defsnc 'unsigned char \(IDX_ACTIVATE_\(READ\|WRITE\)\|\(CM\|ULP\)_\(ENABLE\|SETUP\)\|DM_ACT\|IPA_PDU_HEADER\|\(READ\|WRITE\)_CCW\)\[\] =' drivers/net/qeth_core_mpc.c
    defsnc 'static unsigned char camera_ncm03j_magic\[\] =' arch/sh/boards/board-ap325rxa.c
    defsnc 'static const unsigned short \(sync\|magic[0-3]\)_data\[\] =' arch/sh/boards/mach-migor/lcd_qvga.c
    defsnc 'static unsigned char camera_ov772x_magic\[\] =' arch/sh/boards/mach-migor/setup.c
    defsnc 'static struct chips_init_reg chips_init_[sgacfx]r\[\] =' 'drivers/video/\(asiliant\|chips\)fb.c'

    # This one is quite suspicious, but it's small enough (64 bytes
    # total) that it's believable that it could be actual source code.
    defsnc 'static const __u8 cx11646_fw1\[\]\[3\] =' drivers/media/video/gspca/conex.c

    # Hunting down non-Free firmware-loading code and instructions.
    # Firmware names are to be caught anywhere.

    blobname 'atmsar11\.fw' drivers/atm/ambassador.c

    blob '    sprintf([^;]*fore200[^;]*FW_EXT[^;]*);' drivers/atm/fore200e.c
    blobname '\(pc\|sb\)a200e\(_ecd\)\?\.bin[12]?' drivers/atm/fore200e.c
    blobna 'The supplied firmware images.*fore.*Rebuild and reinstall[^.]*\.' Documentation/networking/fore200e.txt

    blobname 'intelliport2\.bin' drivers/char/ip2/ip2main.c

    blob 'static unsigned char warp_g[24]00_t2\?gzs\?a\?f\?\[\] = {[^{};]*};\([\n][\n]*static unsigned char warp_g[24]00_t2\?gzs\?a\?f\?\[\] = {[^{};]*};\)*' drivers/gpu/drm/mga/mga_ucode.h
    blob '#define \(MGA_WARP_CODE_ALIGN\|WARP_UCODE_\(SIZE\|INSTALL\)\)\([^\n]*\\[ 	]*[\n]\)*[^\n]*' drivers/gpu/drm/mga/mga_warp.c
    blob 'static const unsigned int mga_warp_g[24]00_microcode_size =[^;]*;' drivers/gpu/drm/mga/mga_warp.c
    blob 'static int mga_warp_install_g[24]00_microcode([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/gpu/drm/mga/mga_warp.c
    blobna '\(case MGA_CARD_TYPE_G[^:]*:[ 	\n]*\)\+return [^;]*mga_warp[^;]*microcode[^;]*;\([ 	\n]*\(case MGA_CARD_TYPE_G[^:]*:[ 	\n]*\)\+return [^;]*mga_warp[^;]*microcode[^;]*;[ 	]*\)*' drivers/gpu/drm/mga/mga_warp.c

    blob 'static u32 r128_cce_microcode\[\] = {[^{};]*};' drivers/gpu/drm/r128/r128_cce.c
    blob 'static void r128_cce_load_microcode([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/gpu/drm/r128/r128_cce.c
    blob '	r128_cce_load_microcode([^;]*);' drivers/gpu/drm/r128/r128_cce.c

    blob 'static const u32 R[S0-9]*0_cp_microcode\[\]\[2\] = {[^{};]*};\([\n][\n]*static const u32 R[S0-9]*0_cp_microcode\[\]\[2\] = {[^{};]*};\)*' drivers/gpu/drm/radeon/radeon_microcode.h
    blob 'static void radeon_cp_load_microcode([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}[\n]' drivers/gpu/drm/radeon/radeon_cp.c
    blob '	radeon_cp_load_microcode([^;]*);' drivers/gpu/drm/radeon/radeon_cp.c

    blob 'sub \(sp887[0x]\|tda1004\(5\|6\(lifeview\)\?\)\|av7110\|dec\(2\(00\|54\)0t\|3000s\)\|opera1\|vp7041\|dibusb\|nxt200[24]\|or51\(211\|132_\(qam\|vsb\)\)\|bluebird\) *{\([^}]*\|[^\n]}*\)[\n]}\([\n][\n]*sub \(sp887[0x]\|tda1004\(5\|6\(lifeview\)\?\)\|av7110\|dec\(2\(00\|54\)0t\|3000s\)\|opera1\|vp7041\|dibusb\|nxt200[24]\|or51\(211\|132_\(qam\|vsb\)\)\|bluebird\) *{\([^}]*\|[^\n]}*\)[\n]}\)*' Documentation/dvb/get_dvb_firmware
    blobna 'Please use[^\n]*firmware[^\n]*sp887x[^\n]*\([\n][^\n]\+\)\+' Documentation/dvb/avermedia.txt
    blob 'To extract the firmware[^\n]*Opera DVB-S1 USB-Box.*\/lib\/firmware\/ \.' Documentation/dvb/opera-firmware.txt
    blobname '\(dvb-usb-opera[^\n]*\.fw\|2830S[^\n]*2\.sys\)' Documentation/dvb/opera-firmware.txt
    blob 'Getting the Firmware\([\n][^\n]\+\)*' Documentation/dvb/ttusb-dec.txt

    blob '\/\*[\n 	]*File automatically generated by createinit\.py using data[\n 	]*extracted from AF05BDA\.sys.*};' drivers/media/dvb/dvb-usb/af9005-script.h
    blob '#include "af9005-script\.h"' drivers/media/dvb/dvb-usb/af9005-fe.c
    blobna '[\n]	scriptlen = sizeof(script)[^;]*;[\n]	for[^{]*scriptlen[^{]*{[^}]*[^\n	}]' drivers/media/dvb/dvb-usb/af9005-fe.c

    accept 'struct \(sp8870\|tda1004x\)_config[\n]{[^}]*(\*request_firmware)[^}]*[\n]};' 'drivers/media/dvb/frontends/\(sp8870\|tda1004x\)\.h'
    blob '[/][*]\([^/]*\|[^*/][/]\)*get_dvb_firmware\([^/]*\|[^*/][/]*\)*[*][/]\([\n]#define \(\([^\n 	]*_DEFAULT\|NONFREE\)_FIRMWARE\|"[^"]*"\) \([^\n]*\|[\\][\n]\)*\)*' 'drivers/media/dvb/frontends/\(sp8870\|tda1004x\)\.c'
    accept '[^\n]*->request_firmware([^{;]*NONFREE_FIRMWARE' 'drivers/media/dvb/frontends/\(sp8870\|tda1004x\)\.c'
    blobname 'dvb-fe-sp8870\.fw' drivers/media/dvb/frontends/sp8870.c
    blobname 'dvb-fe-tda1004[56]\.fw' drivers/media/dvb/frontends/tda1004x.c
    accept '	if (state->config->request_firmware != NULL) {' drivers/media/dvb/ttpci/tda1004x.c

    # This bootcode is actually Free Software under GPLv2, but since it's
    # being distributed without source code, we're taking it out.
    blob 'static u8 bootcode\[\] = {[^}]*};' drivers/media/dvb/ttpci/av7110_hw.c
    blobname 'dvb-ttpci-01\.fw' drivers/media/dvb/ttpci/av7110.c
    accept '\(static int\|	\.request_firmware =\) alps_tdlb7_request_firmware[(,]' drivers/media/dvb/ttpci/av7110.c
    defsnc 'static u8 nexusca_stv0297_inittab\[\] =' drivers/media/dvb/ttpci/av7110.c

    accept '\(static int\|	\.request_firmware =\) alps_tdhd1_204_request_firmware[(,]' drivers/media/dvb/ttpci/budget.c

    accept '\(static int\|	\.request_firmware =\) philips_tu1216_request_firmware[(,]' drivers/media/dvb/ttpci/budget-av.c

    accept '\(static int\|	\.request_firmware =\) philips_tdm1316l_request_firmware[(,]' drivers/media/dvb/ttpci/budget-ci.c
    defsnc 'static u8 philips_su1278_tt_inittab\[\] =' drivers/media/dvb/ttpci/budget-ci.c
    defsnc 'static u8 dvbc_philips_tdm1316l_inittab\[\] =' drivers/media/dvb/ttpci/budget-ci.c
    accept '\(static int\|	\.request_firmware =\) philips_tdm1316l_request_firmware[(,]' drivers/media/dvb/ttpci/budget-ci.c

    blobname 'ttusb-budget\/dspbootcode\.bin' drivers/media/dvb/ttusb-budget/dvb-ttusb-budget.c

    blobname 'cpia2\/stv0672_vp4\.bin' drivers/media/video/cpia2/cpia2_core.c

    blobname 'dabusb\/\(firmware\.fw\|bitstream\.bin\)' drivers/media/video/dabusb.c

    blob 'static u32 tigon2\?Fw\(Text\|Rodata\|Data\)\[(MAX_\(TEXT\|RODATA\|DATA\)_LEN\/4) + 1\] __devinitdata = {[^}]*};\([\n]static u32 tigon2\?Fw\(Text\|Rodata\|Data\)\[(MAX_\(TEXT\|RODATA\|DATA\)_LEN\/4) + 1\] __devinitdata = {[^}]*};\)*' drivers/net/acenic_firwmare.h
    blob '#define tigon2\?Fw[^ ]*\(Addr\|Len\) 0x[^\n]*\([\n]#define tigon2\?Fw[^ ]*\(Addr\|Len\) 0x[^\n]*\)\+' drivers/net/acenic_firmware.h
    blob '\([/][*]\([^/]*\|[^*/][/]*\)*Do not try to clear\([^/]*\|[^*/][/]*\)*[*][/][\n]	\)\?ace_clear[^;]*;[\n]\([^}]*{[^}]*ace_copy[^}]*tigon2\?Fw[^}]*}\)*[\n]\+	return 0;[\n]}'

    blob '#include "starfire_firmware\.h"' drivers/net/starfire.c
    blob '[/][*]\([^/]*\|[^*/][/]*\)*Load Rx\/Tx firmware\([^/]*\|[^*/][/]*\)*[*][/]\([\n]	for ([^)]*FIRMWARE_[RT]X_SIZE[^)]*)[\n]		writel[^;]*firmware_[rt]x[^;]*;\)\+' drivers/net/starfire.c

    blob 'static \(u8\|const u32\|struct fw_info\) bnx2_\(\(COM\|CP\|[RT]XP\|TPAT\)_b0[69]Fw\(Text\|Data\|Rodata\)\|\(xi_\)\?rv2p_proc[12]\|\(com\|cp\|[rt]xp\|tpat\)_fw_0[69]\)\(\[[^]};]*\]\)* = {[^}]*};\([\n][\n]*static \(u8\|const u32\|struct fw_info\) bnx2_\(\(COM\|CP\|[RT]XP\|TPAT\)_b0[69]Fw\(Text\|Data\|Rodata\)\|\(xi_\)\?rv2p_proc[12]\|\(com\|cp\|[rt]xp\|tpat\)_fw_0[69]\)\(\[[^]};]*\]\)* = {[^}]*};\)*' 'drivers/net/bnx2_fw2\?.h'
    blob '#include "bnx2_fw2\?\.h"\([\n][\n]*#include "bnx2_fw2\?\.h"\)*' drivers/net/bnx2.c
    blob 'static int[\n]bnx2_init_cpus([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}' drivers/net/bnx2.c

    # init_data_e1h? might actually be just data, but it doesn't
    # really matter.
    blob 'static const u32 \(init\?\|[tucx]sem_\(int_table\|pram\)\)_data_e1h\?\[\] = {[^}]*};\([\n][\n]*static const u32 \(init\?\|[tucx]sem_\(int_table\|pram\)\)_data_e1h\?\[\] = {[^}]*};\)*' drivers/net/bnx2x_init_values.h
    blob 'static \(void \|const u32 \*\)bnx2x_\(sel_blob\|init_wr_wb\|init_block\)([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}\([\n][\n]*static \(void \|const u32 \*\)bnx2x_\(sel_blob\|init_wr_wb\|init_block\)([^{]*)[\n]{[\n]\([^}]\|[^\n}]}*\)*[\n]}\)*' drivers/net/bnx2x_init.h

    blobname 'sun\/cassini\.bin' drivers/net/cassini.c

    blobna 'static u16 \(sr\|twinax\)_edc\[\] = {[^;]*};' drivers/net/cxgb3/ael1002.c
    blobna 'for ([^\n]*ARRAY_SIZE(\(sr\|twinax\)_edc)[^\n]*)[\n][^;]*mdio_write[^;]*;' drivers/net/cxgb3/ael1002.c

    blob '\([/][*][*]*[*][/][\n]*\)*\([/][*]\([^/]\|[^*/][/]*\)*Micro code\([^/]\|[^*/][/]*\)*8086:\([^/]\|[^*/][/]*\)*[*][/]\([\n]*[/][*]\([^/]\|[^*/][/]*\)*[*][/]\)*\|#define  *D10\(1M\(_B\)\?\|1S\|2_E\)_\(CPUSAVER_\(TIMER\|BUNDLE\|MIN_SIZE\)_DWORD\|RCVBUNDLE_UCODE\)[ 	]\(\\[\n]\|[^\n]\)*\)\([\n]*[/][*]\([^/]\|[^*/][/]*\|[*][/][\n]*[/][*]\)*Micro code\([^/]\|[^*/][/]*\)*8086:\([^/]\|[^*/][/]*\)*[*][/]\([\n]*[/][*]\([^/]\|[^*/][/]*\)*[*][/]\)*\|[\n][\n]*#define  *D10\(1M\(_B\)\?\|1S\|2_E\)_\(CPUSAVER_\(TIMER\|BUNDLE\|MIN_SIZE\)_DWORD\|RCVBUNDLE_UCODE\)[ 	]\(\\[\n]\|[^\n]\)*\)*' drivers/net/e100.c
    blobna '\([/][*]\([^/]\|[*][/]*\)*[*][/][\n]*		\)\(ucode\[opts->\(timer\|bundle\|min_size\)_dword\] .= [^;]*;[\n][\n]*		\)*[^}]*UCODE_SIZE[^}]*cb_ucode[^}]*return;[\n]	}' drivers/net/e100.c

    blob 'static unsigned char __devinitdata lanai4_\(code\|data\)\[[0-9]*\] = {[^;]*};' drivers/net/myri_code.h
    blob '#include "myri_code\.h"' drivers/net/myri_sbus.c
    blobna '\([/][*]\([^/]\|[^*/][/]*\)*[*][/][\n	 ]*\)\?for ([^\n]*sizeof(lanai4_\(code\|data\)[^\n]*)[\n][^\n]*sbus_writeb[^;]*lanai4_\(code\|data\)[^;]*lanai4_code_off[^;]*;\([\n	 ]*\([/][*]\([^/]\|[^*/][/]*\)*[*][/][\n	 ]*\)\?for ([^\n]*sizeof(lanai4_\(code\|data\)[^\n]*)[\n][^\n]*sbus_writeb[^;]*lanai4_\(code\|data\)[^;]*lanai4_\(code\|data\)_off[^;]*;\)*' drivers/net/myri_sbus.c

    blob 'static u32 s_firmLoad\[\] = {[^;]*};' drivers/net/tehuti_fw.h
    blob 'bdx_tx_push_desc_safe[^;]*s_firmLoad[^;]*;' drivers/net/tehuti.c
    blob 'for ([^\n]*ARRAY_SIZE(s_firmLoad)[^\n]*)[\n	 ]*s_firmLoad[^;]*=[^;]*s_firmLoad[^;]*;' drivers/net/tehuti.c

    blob ' [*] Firmware is:[\n] [*]	Derived from proprietary[^/]*notice is accompanying it\.[\n] [*][/]' drivers/net/tg3.c
    blob 'Derived from proprietary unpublished source code' drivers/net/tg3.c
    blob '\(static const \)\?u32 tg3\(Tso5\?\)\?Fw\(Text\|Rodata\|Data\)\[[^{]*\] = {[^}]*};\([\n][\n]*\(static const u32 tg3\(Tso5\?\)\?Fw\(Text\|Rodata\|Data\)\[[^{]*\] = {[^}]*};\|#if 0\( [/][*]\([^/]\|[^*/][/]*\)*[*][/]\)\?[\n]\(static const \)\?u32 tg3\(Tso5\?\)\?Fw\(Text\|Rodata\|Data\)\[[^{]*\] = {[^}]*};[\n]#endif\)\)*' drivers/net/tg3.c

    blob 'static const u8 typhoon_firmware_image\[\] = {[^}]*};' drivers/net/typhoon-firmware.h

    blobna 'licensed[^\n]*strictly for use[^\n]*[\n]*[^\n]*COPS LocalTalk' 'drivers/net/appletalk/cops_\(ff\|lt\)drv\.h'
    blob 'static const unsigned char ffdrv_code\[\] = {[^}]*};' drivers/net/appletalk/cops_ffdrv.h
    blob 'static const unsgined char ltdrv_code\[\] = {[^}]*};' drivers/net/appletalk/cops_ltdrv.h
    blob '#include "cops_\(lt\|ff\)drv\.h"[ 	]*\([/][*]\([^/]\|[^*/][/]*\)*Firmware\([^/]\|[^*/][/]*\)*[*][/]\)\?\([\n][\n]*#include "cops_\(lt\|ff\)drv\.h"[ 	]*\([/][*]\([^/]\|[^*/][/]*\)*Firmware\([^/]\|[^*/][/]*\)*[*][/]\)\?\)*' drivers/net/appletalk/cops.c

    blob 'static unsigned char bits_1200\[\] *= {[^}]*};' drivers/net/hamradio/yam1200.h
    blob 'static unsigned char bits_9600\[\] *= {[^}]*};' drivers/net/hamradio/yam9600.h
    blob '#include "yam\(96\|12\)00\.h"\([\n][\n]*#include "yam\(96\|12\)00\.h"\)*' drivers/net/hamradio/yam.c

    blobna 'static const u_char __Xilinx7OD\[\] = {[^}]*};' drivers/net/pcmcia/ositech.h
    blob '#include "ositech\.h"' drivers/net/pcmcia/smc91c92_cs.c
    blobna '\([/][*] Download the Seven of Diamonds firmware[^/]*[*][/][\n	 ]*\)\?for *([^\n]*__Xilinx7OD[^{}]*{[\n][	 ]*outb *(__Xilinx7OD[^}]*}' drivers/net/pcmcia/smc91c92_cs.c

    blob 'static const u8 microcode\[\] = {[^}]*} *;' drivers/net/tokenring/3c359_microcode.h
    blob '#include "3c359_microcode\.h"' drivers/net/tokenring/3c359.c
    blobna '\(printk(KERN_INFO "3C359: Uploading Microcode: ");[\n 	]*\)\?for ([^{]*\(mc_size[^{]*) {[^}]*writeb(microcode\[\|) {[^}]*writeb(microcode\[mc_size\)[^}]*}\([\n][ 	]*printk[^\n]*;[\n 	]*for ([^{]*\(mc_size[^{]*) {[^}]*writeb(microcode\[\|) {[^}]*writeb(microcode\[mc_size\)[^}]*}\)*' drivers/net/tokenring/3c359.c

    blobname 'tr_smctr\.bin' drivers/net/tokenring/smctr.c

    blobname 'kaweth[/]\(new\|trigger\)_code\(_fix\)\.bin' drivers/net/usb/kaweth.c

    blobname '\(agere\|prism\)_\(sta\|ap\)_fw\.bin' drivers/net/wireless/orinoco.c
    blobna 'symbol_sp24t_\(prim\|sec\)_fw' drivers/net/wireless/orinoco.c

    blob 'unsigned short sbus_risc_code01\[\] __devinitdata = {[^}]*};' drivers/scsi/qlogicpti_asm.c
    blob '#include "qlogicpti_asm\.c"' drivers/scsi/qlogicpti.c

    blob '\([/][*] Microcode\([^/]\|[^*/][/]*\)*[*][/][\n]*\)\?static \(u\(nsigned \)\?char\|unsigned short\|ADV_DCNT\) _\(asc_mcode\|adv_asc3\(550\|8C\(08\|16\)00\)\)_\(buf\[\] = {[^}]*}\|size = sizeof[^;]*\|chksum = 0x[^;]*\);\([ 	]*[/][*]\([^/]\|[^*/][/]*\)*[*][/]\)\?\([\n][\n]*\([/][*] Microcode\([^/]\|[^*/][/]*\)*[*][/][\n]*\)\?static \(u\(nsigned \)\?char\|unsigned short\|ADV_DCNT\) _\(asc_mcode\|adv_asc3\(550\|8C\(08\|16\)00\)\)_\(buf\[\] = {[^}]*}\|size = sizeof[^;]*\|chksum = 0x[^;]*\);\([ 	]*[/][*]\([^/]\|[^*/][/]*\)*[*][/]\)\?\)*' drivers/scsi/advansys.c

    blob '\(#ifdef UNIQUE_FW_NAME[\n]\)\?static unsigned short \(risc\|fw12\(80e\|160\)i\)_code01\[\] = {\([\n]#else[\n]static unsigned short risc_code01\[\] = {[\n]#endif[\n]\)\?[^}]*};\([\n][\n]*\(#ifdef UNIQUE_FW_NAME[\n]\)\?static unsigned short \(risc_code\|fw12\(80e\|160\)i\)_length01 = [^;]*;\([\n]#else[\n]static unsigned short risc_code_length01 = [^;]*;[\n]#endif\)\?\)\?' 'drivers/scsi/ql1\(04\|2\(8\|16\)\)0_fw\.h'

    blobname 'emi26[/]\(bitstream\|firmware\|loader\)\.fw' drivers/usb/misc/emi26.c

    blobname 'emi62[/]\(bitstream\|midi\|spdif\|loader\)\.fw' drivers/usb/misc/emi62.c

    blobname 'keyspan[/]\(mpr\|usa\(18x\|19\(q[iw]\|w\)\?\|28\(x\(a\|b\)\?\)\?\|49w\(lc\)\?\)\)\.fw' drivers/usb/serial/keyspan.c

    accept '		fw_name = "keyspan_pda[/]\(keyspan_pda\|xircom_pgs\)\.fw";' drivers/usb/serial/keyspan_pda.c
    blobna 'fw_name = \([^}]\|[^\n]}*\)*\([/][*]KEYSPAN_PDA[*][/]\)\?request_ihex_firmware' drivers/usb/serial/keyspan_pda.c
    accept '	if ([/][*]KEYSPAN_PDA[*][/]request_ihex_firmware' drivers/usb/serial/keyspan_pda.c

    blobname 'edgeport[/]\(boot\|down\)2\?\.fw' drivers/usb/serial/io_edgeport.c
    blobname 'edgeport[/]down3\.bin' drivers/usb/serial/io_ti.c

    blobname 'ti_\(usb-\)\?\(%d\|3410\|5052\)\.bin' drivers/usb/serial/ti_usb_3410_5052.c

    blobname 'whiteheat\(_loader\(_debug\)\?\)\?\.fw' drivers/usb/serial/whiteheat.c

    blob 'static struct BA1struct BA1Struct = {[^;]*};' sound/pci/cs46xx/cs46xx_image.h
    
    blob 'static u32 cwc\(4630\|async\|snoop\)_\(code\|parameter\)\[\] = {[^;]*};' 'sound/pci/cs46xx/imgs/cwc\(4630\|async\|snoop\)\.h'
    # cwcbinhack appears to have been created by hand.
    # cwcdma has sources (not verified) in cwcdma.asp.
    accept 'static u32 cwc\(binhack\|dma\)_code\[\] = {[^;]*};' 'sound/pci/cs46xx/imgs/cwc\(binhack\|dma\)\.h'
    blob '#include "\(cs46xx_image\|imgs[/]cwc\(4630\|async\|snoop\)\)\.h"\([\n][\n]*#include "\(cs46xx_image\|imgs[/]cwc\(4630\|async\|snoop\)\)\.h"\)*' sound/pci/cs46xx/cs46xx_lib.c

    blobname 'korg[/]k1212\.dsp' sound/pci/korg1212/korg1212.c

    blobname 'ess[/]maestro3_assp_\(kernel\|minisrc\)\.fw' sound/pci/maestro3.c

    blobname 'yamaha[/]ds1e\?_\(ctrl\|dsp\)\.fw' sound/pci/ymfpci/ymfpci_main.c

    blobname 'sb16[/]\(\(a\|mu\)law_main\|ima_adpcm_\(init\|capture\|playback\)\)\.csp' sound/isa/sb/sb16_dsp.c

    blob 'static const struct {[^}]*} yss225_registers\[\] __devinitdata = {[^;]*};' sound/isa/wavefront/yss225.c
    blob 'yamaha[/]yss225_registers\.bin' sound/isa/wavefront/wavefront_fx.c
    blobna 'firmware = [&]yss225_registers_firmware;' sound/isa/wavefront/wavefront_fx.c
    blob 'static const struct firmware yss225_registers_firmware = {[^;]*};' sound/isa/wavefront/wavefront_fx.c
    blob 'wavefront\.os' sound/isa/wavefront/wavefront_synth.c

    blobna 'and[\n]require the use of[^\n]*propr\?ietary[^:]*' Documentation/arm/IXP4xx
    blob 'If you need to use any of the above[^\n]*download[^:]*:[\n 	]*http:[^\n]*ixp4[^\n]*' Documentation/arm/IXP4xx

    accept 'int xc_request_firmware(struct xc *[*] *x);' arch/arm/mach-netx/include/mach/xc.h
    accept 'int xc_request_firmware(struct xc *[*] *x)[\n]{' arch/arm/mach-netx/xc.c
    accept 'EXPORT_SYMBOL(xc_request_firmware);' arch/arm/mach-netx/xc.c
    accept '		if (xc_request_firmware(priv->xc)) {' drivers/net/netx-eth.c

    blobname 'iop_fw_load_[sm]pu' arch/cris/arch-v32/drivers/iop_fw_load.c
    accept 'int iop_fw_load_[sm]pu(' arch/cris/arch-v32/drivers/iop_fw_load.c
    accept '	retval = request_firmware[^;]*[&]iop_[sm]pu_device' arch/cris/arch-v32/drivers/iop_fw_load.c
    accept 'EXPORT_SYMBOL(iop_fw_load_[sm]pu);' arch/cris/arch-v32/drivers/iop_fw_load.c

    accept '[/][*] fake device for request_firmware [*][/]' arch/x86/kernel/microcode_core.c

    blobname 'amd-ucode[/]microcode_amd\.bin' arch/x86/kernel/microcode_amd.c

    blobname 'intel-ucode[/]\([0-9a-f][0-9a-f]\|%02x\)-\([0-9a-f][0-9a-f]\|%02x\)-\([0-9a-f][0-9a-f]\|%02x\)' arch/x86/kernel/microcode_intel.c

    blobname 'BCM2033-\(MD\.hex\|FW\.bin\)' drivers/bluetooth/bcm203x.c

    blobname 'bfubase\.frm' drivers/bluetooth/bfusb.c

    blobname 'BT3CPCC\.bin' drivers/bluetooth/bt3c_cs.c

    blobname 'cyzfirm\.bin' drivers/char/cyclades.c

    accept 'MODULE_FIRMWARE("dsp56k[/]bootstrap\.bin");' drivers/char/dsp56k.c
    blob '	const char fw_name\[\] = "dsp56k[/]bootstrap\.bin";\([^}]\|[^\n]}*\)*request_firmware\([^}]\|[^\n]}*\)*[\n]	err = request_firmware([&]fw, fw_name, ' drivers/char/dsp56k.c
    accept '	const char fw_name\[\] = "dsp56k[/]bootstrap\.bin";\([^}]\|[^\n]}*\)*[\n]	err = request_firmware([&]fw, fw_name, ' drivers/char/dsp56k.c

    blobname 'isi\(6\(08\|\(08\|16\)em\)\|46\(08\|16\)\)\.bin' drivers/char/isicom.c

    blobname 'c\(218t\|p204\|320t\)unx\.code' drivers/char/moxa.c
    accept '		printk(KERN_ERR "MOXA: request_firmware failed' drivers/char/moxa.c

    # This driver enables the user to update the non-Free BIOS, but it
    # only issues a firmware request if specifically told to.  It
    # doesn't require any non-Free firwmare to function, and it
    # doesn't actually recommend users to perform updates, so I'm
    # leaving it in.
    accept '			req_firm_rc = request_firmware_nowait([^;], "dell_rbu",' drivers/firmware/dell_rbu.c

    blobname 'xc3028-v27\.fw' drivers/media/common/tuners/tuner-xc2028.h
    accept '#define XC\(2028\|3028L\)_DEFAULT_FIRMWARE NONFREE_FIRMWARE' drivers/media/common/tuners/tuner-xc2028.h
    blobname 'xc3028L-v36\.fw' drivers/media/common/tuners/tuner-xc2028.h
    blobname 'dvb-fe-xc5000-1\.1\.fw' drivers/media/common/tuners/xc5000.c
    accept '#define XC5000_DEFAULT_FIRMWARE\( NONFREE_FIRMWARE\|_SIZE\)' drivers/media/common/tuners/xc5000.c
    accept '[ 	]*\(\(ctl\)\?\(->\|[.]\)fname[ 	]*=[ 	]*\|if (fw->size != \|ret = reject_firmware([&]fw, \)\?XC\(2028\|3028L\|5000\)_DEFAULT_FIRMWARE' 'drivers/media/video/\(common/tuners/\(xc5000\.c\|tuner-xc2028\.h\)\|saa7134/saa7134-cards\.c\|em28xx/em28xx-cards\.c\|cx23885/cx23885-dvb\.c\|cx88/cx88-\(cards\|dvb\)\.c\|cx18/cx18-driver\.c\|ivtv/ivtv-driver\.c\|dvb/dvb-usb/\(dib0700_devices\|cxusb\)\.c\)'

    blobname '4210\(100[12]\|%4X\)\.sb' drivers/net/irda/irda-usb.c

    blobname 'myri10ge_\(rss_\)\?ethp\?_z8e\.dat' drivers/net/myri10ge.c

    blobname 'spider_fw\.bin' drivers/net/spider_net.h

    blobname 'tms380tr\.bin' drivers/net/tokenring/tms380tr.c

    blobname 'atmel_at76c50\(2\([de]\|_3com\)\?\|4a\?\(_2958\)\?\|6\)\(\.bin\)\?' drivers/net/wireless/atmel.c

    blobname 'b43[^/]*[/]\(%s\|ucode\(5\|1[13]\)\|pcm5\|[abn]0g[01]initvals\(5\|1[13]\)\)\.fw' 'drivers/net/wireless/b43\(legacy\)\?/main.c'

    blob '#define IPW2100_FW_\(\(MAJOR\|MINOR\)\(_VERSION\|(x)\)\|VERSION\) \([^\n]\|[\\][\n]\)*\([\n][\n]*#define IPW2100_FW_\(\(MAJOR\|MINOR\)\(_VERSION\|(x)\)\|VERSION\) \([^\n]\|[\\][\n]\)*\)*' drivers/net/wireless/ipw2100.c
    blobname 'ipw2100-\("\([^"\n]\|[\\][\n]\)*"\([^"]\|[\\]["]\)*\)\+' drivers/net/wireless/ipw2100.c
    blobname '__stringify(IPW2100_FW_MINOR_VERSION)' drivers/net/wireless/ipw2100.c

    accept '[/][*] Call this function from process context\([^/]\|[^*][/]*\)*request_firmware' drivers/net/wireless/ipw2200.c
    blobname 'ipw2200-\(i\?bss\|sniffer\)\.fw' drivers/net/wireless/ipw2200.c
    accept '		IPW_ERROR("%s request_firmware failed' drivers/net/wireless/ipw2200.c

    blobname 'iwlwifi-\(3945\|4965\|5000\)" IWL\(3945\|4965\|5000\)_UCODE_API "\.ucode' 'drivers/net/iwlwifi/iwl\(3945-base\|-4965\|-5000\)\.c'
    accept '	 [*] request_firmware() is synchronous' 'drivers/net/iwlwifi/iwl\(3945-base\|-agn\)\.c'

    blobname 'libertas_cs\(_helper\)\?\.fw' drivers/net/wireless/libertas/if_cs.c

    blobname 'sd\(8385\|8686\)\(_helper\)\?\.bin' drivers/net/wireless/libertas/if_sdio.c

    blobname 'usb8388\(-5\.126\.0\.p5\)\?\.bin' drivers/net/wireless/libertas/if_usb.c
    accept '		lbs_pr_err("request_firmware() failed' drivers/net/wireless/ipw2200.c

    blobname 'lbtf_usb\.bin' drivers/net/wireless/libertas_tf/if_usb.c

    blobname 'isl38\(86\|87usb_bare\|90usb\)' 'drivers/net/wireless/p54/p54\(pci\.c\|usb\.[ch]\)'

    blobname 'isl38\(77\|86\|90\)' drivers/net/wireless/prism54/islpci_dev.c

    blobname 'rt2[56]61s\?\.bin' drivers/net/wireless/rt2x00/rt61pci.h
    blobname 'rt73\.bin' drivers/net/wireless/rt2x00/rt73usb.h

    blobname 'zd1201\(-ap\)\?\.fw' drivers/net/wireless/zd1201.c

    blobname 'zd1211[/]zd1211b\?_\(u\([rb]\|phr\)\?\)\?' drivers/net/wireless/zd1211/zd_usb.c

    # ??? gotta introduce some means to match false-positives
    # including post context containing blobs, so that the macro name
    # is not flagged or deblobbed, but the blob name is.
    # blobna 'PCMCIA_\([PM]FC_\)\?DEVICE_CIS_\(MANF_CARD\|PROD_ID[1-4]*\)'
    # accept '	    PCMCIA_\([PM]FC_\)\?DEVICE_CIS_\(MANF_CARD\|PROD_ID[1-4]*\)([^)]*, "[/][*](DEBLOBBED)[*][/]")'
    # accept '#define PCMCIA_\([PM]FC_\)\?DEVICE_CIS_\(MANF_CARD\|PROD_ID[1-4]*\)(' include/pcmcia/device_id.h

    blobname '3CCFEM556\.cis' drivers/net/pcmcia/3c574_cs.c

    blobname '3CXEM556\.cis' drivers/net/pcmcia/3c589_cs.c

    blobname '\(PCMLM28\|DP83903\|LA-PCM\|PE520\|NE2K\|PE-200\|tamarack\)\.cis' drivers/net/pcmcia/pcnet_cs.c

    blobname '\(PCMLM28\|DP83903\|3C\(CF\|X\)EM556\|SW_\([78]xx\|555\)_SER\|MT5634ZLX\|COMpad[24]\|RS-COM-2P\|GLOBETROTTER\)\.cis' drivers/serial/serial_cs.c

    # This looks suspicious, but it pretty much just sets stuff to zero.
    initnc 'static __u8 mode8420\(pro\|con\)\[\] =' drivers/media/video/cs8420.h

    # quite suspicious
    # arch/parisc/kernel/perf_images.h
    initc 'static uint32_t onyx_images\[\]\[PCXU_IMAGE_SIZE\/sizeof(uint32_t)\] __read_mostly ='
    initc 'static uint32_t cuda_images\[\]\[PCXW_IMAGE_SIZE\/sizeof(uint32_t)\] __read_mostly ='

    # These are regarded as ok
    initnc 'static const u8 SN9C102_\(Y\|UV\)_QTABLE[01]\[64\] = {'
    initnc '	static \(const \)\?u8 jpeg_header\[589\] = {' media/video/sn9c102/sn9c102_core.c
    accept '[	]\{1,2\}err = sn9c102_write_const_regs(cam\(,[ 	\n]\+{0x[0-9a-fA-F][0-9a-fA-F], 0x[0-9a-fA-F][0-9a-fA-F]}\)*);'

    # too lax?
    defsnc 'static yyconst \(flex_int\(16\|32\)_t\|\(\(short \)\?int\)\) yy_[^[]*\[[][0-9]*\] ='
    defsnc 'static const \(yytype_u\?int\(8\|16\)\|\(unsigned \)\?\(short\( int\)\?\|char\)\) yy[^[]*\[\] ='
    initnc '\(\|	\)static \(const \|\)\(unsigned \(short\|char\)\|struct SiS_[^ ]*\) SiS[^[]*\(\[[] [*0-9]*\]\)\+ *='

    initnc 'static const a3d_Hrtf_t A3dHrirZeros = {'
    initnc 'static const a3d_Hrtf_t A3dHrirImpulse = {'
    initnc 'static const a3d_Hrtf_t A3dHrirOnes = {'
    initnc 'static const a3d_Hrtf_t A3dHrirSatTest = {'
    initnc 'static const a3d_Hrtf_t A3dHrirDImpulse = {'
    initnc 'static const a3d_ItdDline_t A3dItdDlineZeros = {'
    initnc 'static auxxEqCoeffSet_t asEqCoefsNormal = {'
    initnc 'static xtalk_dline_t const alXtalkDlineTest = {'
    initnc 'static struct nand_ecclayout rtc_from4_nand_oobinfo = {'
    initnc 'static const s16 tempLUT\[\] ='
    initnc 'static const u8 viaLUT\[\] ='
    initnc 'static struct { int xres, yres, left, right, upper, lower, hslen, vslen, vfreq; } timmings\[\] __initdata = {'
    initnc 'static struct platinum_regvals platinum_reg_init_[0-9]* = {'
    initnc '} sisfb_ddc[sf]modes\[\] __devinitdata ='
    initnc 'static struct dvb_pll_desc [^\n]* = {'
    initnc 'static u32 LABELPATCHES\[\] __attribute((unused)) ='

    initnc 'static dbdev_tab_t dbdev_tab\[\] ='
    accept '\(EXP\|LOG\|ATAN\)TBL:'"$sepx$blobpat*"
    initnc 'static char fm_volume_table\[128\] ='
    initnc 'unsigned int snd_gf1_scale_table\[SNDRV_GF1_SCALE_TABLE_SIZE\] ='
    # remaining after original deblob_2_6_24, not fully checked

    oprepline '#define OV51[18]_\(Y\|UV\)QUANTABLE {'
    initnc '		static unsigned char const data_bit\[64\] ='
    initnc '		static const u8 data_sbit\[32\] ='
    initnc '	\.RightCoefs ='
    initnc '	#define WakeupSeq    {'
    initnc '	SetRate44100\[\] ='
    initnc '	const short period\[32\] ='
    defsnc '	\(const static\|static const\) int desc_idx_table\[\] =' 'arch/arm/include/asm/hardware/iop3xx-adma.h|include/asm-arm/hardware/iop3xx-adma.h'
    initnc '	int prop_bcomm_irq\[3\*16\] ='
    initnc '	static char logSlopeTable\[128\] ='
    initnc '	static const int uc_\(dup\|word\)_table\[\]\[2\] ='
    initnc '	static const struct mc7_timing_params mc7_timings\[\] ='
    initnc '	static const u8 biphase_tbl\[\] ='
    initnc '	static const u8 cs170\[7 \* 8\] ='
    initnc '	static const u8 cs3[13]a\[8 \* 4\] ='
    initnc '	static const u8 dramsr13\[12 \* 5\] ='
    initnc '	static const u8 log10\[\] ='
    initnc '	static const u8 mpeg_hdr_data\[\] ='
    initnc '	static const u8 sdramtype\[13\]\[5\] ='
    initnc '	static const u8 t\[\] ='
    initnc '	static const unsigned int avg_pkts\[NCCTRL_WIN\] ='
    initnc '	static const unsigned short ac97_defaults\[\] ='
    initnc '	static int exp_lut\[256\] ='
    initnc '	static u16 jpeg_tables\[\]\[70\] ='
    initnc '	static u16 tables\[\] ='
    initnc '	static u32 logMagTable\[128\] ='
    initnc '	static u8 init_bufs\[13\]\[5\] ='
    initnc '	static u8 sine \[\] ='
    initnc '	static u_short geometry_table\[\]\[[45]\] ='
    initnc '	static unsigned char CRCTable1\[\] ='
    initnc '	static unsigned char CRCTable2\[\] ='
    initnc '	static unsigned char default_colors\[\] ='
    initnc '	static unsigned char iso_regs\[8\]\[4\] ='
    initnc '	static unsigned char log_scale\[101\] =' sound/oss/pss.c
    initnc '	static unsigned char msg\[\] ='
    initnc '	static unsigned char static_pad\[\] ='
    initnc '	static unsigned char table_alaw2ulaw\[\] ='
    initnc '	static unsigned char table_ulaw2alaw\[\] ='
    defsnc '	u32 reg_boundaries\[\] =' drivers/net/bnx2.c
    initnc '	u8 b\[\] ='
    initnc '	uint8_t tx\[\] ='
    initnc '	unsigned char saa7111_regs\[\] ='
    initnc '	unsigned char sas_pcd_m_pg\[\] ='
    initnc '	} modedb\[5\] ='
    defsnc '	} reg_tbl\[\] =' drivers/net/bnx2.c
    initnc '	} vals\[\] ='
    initnc '	} vm_devices\[\] ='
    initnc '    static const code distfix\[32\] ='
    initnc '    static const code lenfix\[512\] ='
    initnc '  int poly\[\]='
    initnc '  static const unsigned char asso_values\[\] ='
    initnc '  static unsigned char asso_values\[\] ='
    initnc '  } cards_ds\[\] ='
    initnc '    static const int8 countLeadingZerosHigh\[\] ='
    initnc '    static const unsigned short d\(base\|ext\)\[32\] ='
    initnc '#define OV511_QUANTABLESIZE	64'
    initnc 'BYTE BtCard::SRAMTable_\(NTSC\|PAL\)\[\] ='
    initnc 'BYTE SRAMTable\[\]\[ 60 \] ='
    accept 'irq_prio_\([hdl]\|l[cd]\):'"$sepx$blobpat*" 'arch/arm/inlcude/asm/hardware/entry-macro-iomd.S|include/asm-arm/hardware/entry-macro-iomd.S'
    initc '__u8 _ascebc\[256\] ='
    initc '__u8 _ebc_tolower\[256\] ='
    initc '__u8 _ebc_toupper\[256\] ='
    initnc 'adapter_tag_info_t aic7[9x]xx_tag_info\[\] ='
    initnc 'char dmasound_alaw2dma8\[\] ='
    initnc 'char dmasound_ulaw2dma8\[\] ='
    initnc 'const struct aper_size_info_16 agp3_generic_sizes\[AGP_GENERIC_SIZES_ENTRIES\] ='
    initnc 'const u16 crc_itu_t_table\[256\] ='
    initnc 'const u8 byte_rev_table\[256\] ='
    initnc 'const u8 crc7_syndrome_table\[256\] ='
    initnc 'int snd_sf_vol_table\[128\] ='
    initnc 'static	u_char	irq_to_siubit\[\] ='
    initnc 'static	u_char	irq_to_siureg\[\] ='
    initnc 'static Byte_t RData\[RDATASIZE\] ='
    initnc 'static __const__ __u16 gx_coeff\[256\] ='
    initnc 'static __u8 init7121ntsc\[\] ='
    initnc 'static __u8 init7121pal\[\] ='
    initnc 'static byte capidtmf_leading_zeroes_table\[0x100\] ='
    defsnc 'static char channel_map_madi_[sdq]s\[HDSPM_MAX_CHANNELS\] =' sound/pci/rme9652/hdspm.c
    initnc 'static char coefficients\[NM_TOTAL_COEFF_COUNT \* 4\] ='
    initnc 'static char ecc_syndrome_table\[\] ='
    initnc 'static char isdn_audio_alaw_to_ulaw\[\] ='
    initnc 'static char isdn_audio_ulaw_to_alaw\[\] ='
    initnc 'static char mix_cvt\[101\] ='
    initnc 'static char opl3_volume_table\[128\] ='
    initnc 'static const __u16 crc10_table\[256\] ='
    initnc 'static const __u32 crc_c\[256\] ='
    initnc 'static const fixp_t cos_table\[46\] ='
    initnc 'static const int init_seq\[\] ='
    initnc 'static const int mobile_vid_table\[32\] ='
    initnc 'static const s16 snd_opl4_pitch_map\[0x600\] ='
    initnc 'static const s8 budtab\[256\] ='
    initnc 'static const struct aper_size_info_32 u3_sizes\[8\] ='
    initnc 'static const struct aper_size_info_8 via_generic_sizes\[9\] ='
    initnc 'static const struct color clut_vga16\[16\] ='
    defsnc 'static const struct gain_entry gain_table\[2\]\[108\] =' drivers/net/wireless/iwl-4965.c
    initnc 'static const struct mV_pos __initdata mobilevrm_mV\[32\] ='
    initnc 'static const struct mV_pos __initdata vrm85_mV\[32\] ='
    initnc 'static const struct menelaus_vtg_value vcore_values\[\] ='
    initnc 'static const struct opl4_region regions_[0-9a-frums]*\[\] ='
    initnc 'static const struct regval regval_table\[\] ='
    initnc 'static const struct rf_channel rf_vals_5222\[\] ='
    initnc 'static const struct rf_channel rf_vals_5225_2527\[\] ='
    initnc 'static const struct rf_channel rf_vals_5226\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2522\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2523\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2524\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2525\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2525e\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2528\[\] ='
    initnc 'static const struct rf_channel rf_vals_noseq\[\] ='
    initnc 'static const struct rf_channel rf_vals_seq\[\] ='
    initnc 'static const u16 Sbox\[256\] ='
    initnc 'static const u16 count_lut\[\] ='
    # drivers/net/e1000e/phy.c
    initnc 'static const u16 e1000_igp_2_cable_length_table\[\] ='
    initnc 'static const u16 rtl8225bcd_rxgain\[\] ='
    initnc 'static const u16 rtl8225z2_rxgain\[\] ='
    initnc 'static const u16 stufftab\[5 \* 256\] ='
    initnc 'static const u16 tkip_sbox\[256\] ='
    initnc 'static const u16 wm8753_reg\[\] ='
    initnc 'static const u32 SS[0-3]\[256\] ='
    initnc 'static const u32 S[1-8]\[64\] ='
    initnc 'static const u32 T[0-5]\[256\] ='
    initnc 'static const u32 Tm\[24\]\[8\] ='
    initnc 'static const u32 bass_table\[41\]\[5\] ='
    initnc 'static const u32 bf_sbox\[256 \* 4\] ='
    initnc 'static const u32 camellia_sp0222\[256\] ='
    initnc 'static const u32 camellia_sp1110\[256\] ='
    initnc 'static const u32 camellia_sp3033\[256\] ='
    initnc 'static const u32 camellia_sp4404\[256\] ='
    initnc 'static const u32 crc32c_table\[256\] ='
    initnc 'static const u32 db_table\[101\] ='
    initnc 'static const u32 m8xx_size_to_gray\[M8XX_SIZES_NO\] ='
    initnc 'static const u32 mds\[4\]\[256\] ='
    initnc 'static const u32 pc2\[1024\] ='
    initnc 'static const u32 s[1-7]\[256\] ='
    initnc 'static const u32 sb8\[256\] ='
    initnc 'static const u32 tfrc_calc_x_lookup\[TFRC_CALC_X_ARRSIZE\]\[2\] ='
    initnc 'static const u32 treble_table\[41\]\[5\] ='
    initnc 'static const u64 [CT][0-7]\[256\] ='
    initnc 'static const u64 sbox[1-4]\[256\] ='
    initnc 'static const u64 sha512_K\[80\] =' 'crypto/sha512\(_generic\)\?.c'
    initnc 'static const u8 Tr\[4\]\[8\] ='
    initnc 'static const u8 aes_sbox\[256\] ='
    initnc 'static const u8 calc_sb_tbl\[512\] ='
    initnc 'static const u8 exp_to_poly\[492\] ='
    initnc 'static const u8 legal_ansi_char_array\[0x40\] ='
    initnc 'static const u8 parity\[\] ='
    initnc 'static const u8 pc1\[256\] ='
    initnc 'static const u8 poly_to_exp\[255\] ='
    initnc 'static const u8 q[01]\[256\] ='
    initnc 'static const u8 ratio_lut\[\] ='
    initnc 'static const u8 rs\[256\] ='
    initnc 'static const u8 rtl8225_agc\[\] ='
    initnc 'static const u8 rtl8225_tx_power_cck\[\] ='
    initnc 'static const u8 rtl8225_tx_power_cck_ch14\[\] ='
    initnc 'static const u8 rtl8225z2_tx_gain_cck_ofdm\[\] ='
    initnc 'static const u_char irq_to_siubit\[\] ='
    initnc 'static const u_char irq_to_siureg\[\] ='
    initnc 'static const uint8_t parity\[256\] ='
    initnc 'static const unsigned char \(UV\|Y\)_QUANTABLE\[64\] ='
    initnc 'static const unsigned char __initdata mV_mobilevrm\[32\] ='
    initnc 'static const unsigned char __initdata mV_vrm85\[32\] ='
    initnc 'static const unsigned char barco_p1\[2\]\[9\]\[7\]\[3\] ='
    initnc 'static const unsigned char bitcounts\[256\] ='
    initnc 'static const unsigned char blue\[256\] ='
    initnc 'static const unsigned char chktab[hl]\[256\] ='
    initnc 'static const unsigned char comet_miireg2offset\[32\] ='
    initnc 'static \(const \)\?unsigned char euc2sjisibm_g3upper_map\[\]\[2\] ='
    initnc 'static const unsigned char green\[256\] ='
    initnc 'static const unsigned char hash_table_ops\[64\*4\] ='
    initnc 'static const unsigned char hid_keyboard\[256\] ='
    initnc 'static const unsigned char mts_direction\[256\/8\] ='
    initnc 'static const unsigned char red\[256\] ='
    initnc 'static \(const \)\?unsigned char sjisibm2euc_map\[\]\[2\] ='
    initnc 'static const unsigned char vol_cvt_datt\[128\] ='
    initnc 'static const unsigned int MulIdx\[16\]\[16\] ='
    initnc 'static const unsigned int crctab32\[\] ='
    initnc 'static const unsigned short crc_flex_table\[\] ='
    initnc 'static const unsigned short logtable\[256\] ='
    initnc 'static const unsigned short wd7000_iobase\[\] ='
    initnc 'static const unsigned short x86_keycodes\[256\] ='
    initnc 'static const unsigned table\[\] ='
    initnc 'static int MV300_reg_8bit\[256\] \?=' drivers/video/atafb.c
    initnc 'static int fifo_map\[\]\[MAX_TX_FIFOS\] ='
    initnc 'static int initial_lfsr\[\] ='
    initnc 'static int log_tbl\[129\] ='
    initnc 'static int miro_fmtuner\[\]  =' drivers/media/video/bt8xx/bt-cards.c
    initnc 'static int miro_tunermap\[\] =' drivers/media/video/bt8xx/bt-cards.c
    initnc 'static int register_size\[\] ='
    initnc 'static int reserve_list\[MAX_RES_ARGS\] ='
    initnc 'static int reverse6\[64\] ='
    initnc 'static short attack_time_tbl\[128\] ='
    defsnc 'static short beep_wform\[256\] =' 'sound/ppc/beep.c|sound/oss/dmasound/dmasound_awacs.c|arch/ppc/8xx_io/cs4218_tdm.c'
    initnc 'static short decay_time_tbl\[128\] ='
    initnc 'static short isdn_audio_[ua]law_to_s16\[\] ='
    initnc 'static struct iwl\(3945\)\?_tx_power power_gain_table\[2\]\[IWL_MAX_GAIN_ENTRIES\] ='
    initnc 'static struct ovcamchip_regvals regvals_init_\(76be\|7[16]20\|7x10\)\[\] ='
    initnc 'static struct regval_list ov7670_default_regs\[\] ='
    initnc 'static struct s_c2 SetRate48000\[\] ='
    initnc 'static struct tea6420_multiplex TEA6420_line\[MXB_AUDIOS+1\]\[2\] ='
    initnc 'static struct wm_info i810_wm_16_100\[\] ='
    initnc 'static struct wm_info i810_wm_16_133\[\] ='
    initnc 'static struct wm_info i810_wm_24_100\[\] ='
    initnc 'static struct wm_info i810_wm_24_133\[\] ='
    initnc 'static struct wm_info i810_wm_8_100\[\] ='
    initnc 'static struct wm_info i810_wm_8_133\[\] ='
    initnc 'static struct { struct fb_bitfield red, green, blue, transp; int bits_per_pixel; } colors\[\] ='
    initnc 'static u16 asEqCoefsPipes\[64\] ='
    initnc 'static u16 asEqCoefsZeros\[50\] ='
    initnc 'static u16 asEqOutStateZeros\[48\] ='
    initnc 'static u16 default_key_map \[256\] ='
    initnc 'static u16 eq_levels\[64\] ='
    initnc 'static u32  crc32tab\[\] __attribute__ ((aligned(8))) ='
    initnc 'static u32 ac3_frames\[3\]\[32\] ='
    initnc 'static u32 adwDecim8\[33\] ='
    initnc 'static u32 h_prescale\[64\] ='
    initnc 'static u32 v_gain\[64\] ='
    initnc 'static u8 SRAM_Table\[\]\[60\] ='
    initnc 'static u8 alps_tdee4_stv0297_inittab\[\] ='
    defsnc 'static u8 bnx2_570[68]_stats_len_arr\[BNX2_NUM_STATS\] =' drivers/net/bnx2.c
    initnc 'static u8 flit_desc_map\[\] ='
    defsnc 'static u8 init_tab \?\[\] =' 'drivers/media/dvb/frontends/cx2270\(0\|2\)\.c'
    defsnc 'static u8 mac_reader\[\] =' drivers/net/wireless/atmel.c
    initnc 'static u8 mt2131_config1\[\] =' drivers/media/dvb/frontends/mt2131.c # <= 2.6.25
    initnc 'static u8 mt2131_config1\[\] =' drivers/media/common/tuners/mt2131.c # >= 2.6.26
    initnc 'static u8 mt2266_init2\[\] =' drivers/media/dvb/frontends/mt2266.c # <= 2.6.25
    initnc 'static u8 mt2266_init2\[\] =' drivers/media/common/tuners/mt2266.c # >= 2.6.26
    initnc 'static u8 opera1_inittab\[\] ='
    initnc 'static u8 saa7113_init_regs\[\] ='
    initnc 'static u8 samsung_tbmu24112_inittab\[\] ='
    initnc 'static u8 w1_crc8_table\[\] ='
    initnc 'static u_char const data_sizes_32\[32\] ='
    initnc 'static u_long ident_map\[32\] ='
    initnc 'static u_short alt_map\[NR_KEYS\] ='
    initnc 'static u_short altgr_map\[NR_KEYS\] ='
    initnc 'static u_short ctrl_alt_map\[NR_KEYS\] ='
    initnc 'static u_short ctrl_map\[NR_KEYS\] *='
    initnc 'static u_short shift_ctrl_map\[NR_KEYS\] ='
    initnc 'static u_short shift_map\[NR_KEYS\] *='
    initnc 'static uchar perm1\[56\] ='
    initnc 'static uchar perm2\[48\] ='
    initnc 'static uchar perm3\[64\] ='
    initnc 'static uchar perm4\[48\] ='
    initnc 'static uchar perm5\[32\] ='
    initnc 'static uchar perm6\[64\] ='
    initnc 'static uchar sbox\[8\]\[4\]\[16\] ='
    initnc 'static uint16_t crc_table\[256\] ='
    initnc 'static uint8_t lpfcAlpaArray\[\] ='
    initnc 'static \(const \)\?uint8_t seqprog\[\] ='
    initnc 'static unsigned char V110_OffMatrix_9600\[\] ='
    initnc 'static unsigned char V110_OnMatrix_9600\[\] ='
    initnc 'static unsigned char a2232_65EC02code\[\] ='
    initnc 'static unsigned char atkbd_set3_keycode\[512\] ='
    initnc 'static unsigned char atkbd_unxlate_table\[128\] ='
    initnc 'static unsigned char banner_table\[\] =' arch/sh/boards/superh/microdev/led.c
    initnc 'static unsigned char bootlogo_bits\[\] ='
    initnc 'static unsigned char bus2core_8260\[\] ='
    initnc 'static unsigned char bus2core_8280\[\] ='
    initnc 'static unsigned char caseorder\[256\] ='
    initnc 'static unsigned char crystal_key\[\] ='
    initnc 'static unsigned char dsp_ulaw\[\] ='
    initnc 'static unsigned char expressiontab\[128\] ='
    initnc 'static unsigned char header2\[\] ='
    initnc 'static unsigned char hidp_keycode\[256\] ='
    initnc 'static unsigned char nkbd_keycode\[128\] ='
    initnc 'static unsigned char pan_volumes\[256\] ='
    initnc 'static unsigned char parm_block\[32\] ='
    initnc 'static unsigned char raw3270_ebcgraf\[64\] ='
    initnc 'static unsigned char rfcomm_crc_table\[256\] ='
    initnc 'static unsigned char rwa_unlock\[\] __initdata ='
    initnc 'static unsigned char seqprog\[\] ='
    initnc 'static unsigned char snd_opl4_volume_table\[128\] ='
    initnc 'static unsigned char splash_bits\[\] ='
    initnc 'static unsigned char sunkbd_keycode\[128\] ='
    initnc 'static unsigned char ufs_fragtable_8fpb\[\] ='
    initnc 'static unsigned char ufs_fragtable_other\[\] ='
    initnc 'static unsigned char ulaw_dsp\[\] ='
    initnc 'static unsigned char usb_kbd_keycode\[256\] ='
    initnc 'static unsigned char vga_font\[cmapsz\] \(BTDATA \|\)='
    initnc 'static unsigned char voltab[12]\[128\] ='
    initnc 'static unsigned char vpd89_data\[\] ='
    initnc 'static unsigned char xtkbd_keycode\[256\] ='
    initnc 'static unsigned int ac3_bitrates\[32\] ='
    initnc 'static unsigned int bass_volume_table\[\] ='
    initnc 'static unsigned int bitrates\[3\]\[16\] ='
    initnc 'static unsigned int isa_dma_port\[8\]\[7\] ='
    initnc 'static unsigned int master_volume_table\[\] ='
    initnc 'static unsigned int mixer_volume_table\[\] ='
    initnc 'static unsigned int pan_table\[63\] ='
    initnc 'static unsigned int snapper_bass_volume_table\[\] ='
    initnc 'static unsigned int snapper_treble_volume_table\[\] ='
    initnc 'static unsigned int treble_volume_table\[\] ='
    initnc 'static unsigned int valid_mem\[\] ='
    initnc 'static unsigned long arthur_to_linux_signals\[32\] ='
    initnc 'static unsigned long shmedia_opcode_table\[64\] ='
    initnc 'static unsigned nv\([34]\|10\)TableP\(FIFO\|GRAPH\|RAMIN\)\[\]\[2\] ='
    initnc 'static unsigned short fcstab\[256\] ='
    initnc 'static unsigned short init[1234]\[128\] \/\*__devinitdata\*\/ ='
    initnc 'static unsigned short log_table\[LOG_TABLE_SIZE\*2\] ='
    initnc 'static unsigned short rc_ioport\[\] ='
    initnc 'static unsigned short translations\[\]\[256\] ='
    initnc 'static unsigned short treble_parm\[12\]\[9\] ='
    initnc 'struct RGBColors TextCLUT\[256\] ='
    initnc 'struct VgaRegs GenVgaTextRegs\[NREGS+1\] ='
    initnc 'struct battery_thresh  spitz_battery_levels_noac\[\] ='
    initnc 'struct battery_thresh spitz_battery_levels_acin\[\] ='
    initnc 'struct fb_bitfield rgb_bitfields\[\]\[4\] ='
    initnc 'struct mode_registers std_modes\[\] ='
    initnc 'struct vmode_attr vmode_attrs\[VMODE_MAX\] ='
    initnc 'u16 const crc16_table\[256\] ='
    initnc 'u16 const crc_ccitt_table\[256\] ='
    initnc 'u16 hfsplus_compose_table\[\] ='
    initnc 'u16 hfsplus_decompose_table\[\] ='
    initnc 'u_char const data_sizes_16\[32\] ='
    initnc 'u_short alt_map\[NR_KEYS\] ='
    initnc 'u_short altgr_map\[NR_KEYS\] ='
    initnc 'u_short ctrl_alt_map\[NR_KEYS\] ='
    initnc 'u_short ctrl_map\[NR_KEYS\] *='
    initnc 'u_short plain_map\[NR_KEYS\] *='
    initnc 'u_short shift_ctrl_map\[NR_KEYS\] ='
    initnc 'u_short shift_map\[NR_KEYS\] *='
    initnc 'uint patch_2[0f]00\[\] ='
    initnc '\(uint16_t\|u16\) e1000_igp_cable_length_table\[IGP01E1000_AGC_LENGTH_TABLE_SIZE\] =' drivers/net/e1000/e1000_hw.c # u16 on 2.6.26
    initnc '\(uint16_t\|u16\) e1000_igp_2_cable_length_table\[IGP02E1000_AGC_LENGTH_TABLE_SIZE\] =' drivers/net/e1000/e1000_hw.c # u16 on 2.6.26
    initnc '} euc2sjisibm_jisx0212_map\[\] ='
    initnc '} freq\[\] ='
    initnc '} hps_h_coeff_tab \[\] ='
    initnc '} hps_v_coeff_tab \[\] ='
    initnc '} init_tab\[\] ='
    initnc '} maven_gamma\[\] ='
    initnc '} mem_table\[\] ='
    initnc '} mxb_saa7740_init\[\] ='
    initnc '} pll_table\[\] =' drivers/video/geode/lxfb_ops.c
    initnc '} qam256_snr_tab\[\] ='
    initnc '} qam64_snr_tab\[\] ='
    initnc '} sil_port\[\] ='
    initnc '} vsb_snr_tab\[\] ='

    ;;

  */patch*2.6.28-rc*)
    # new in 2.6.28
    accept '\(static \)\?const char \(inv\)\?parity\[256\] = {[	 \n01,]*};' 'Documentation/mtd/nand_ecc\.txt\|drivers/mtd/nand/nand_ecc\.c'
    defsnc 'static const char \(bitsperbyte\|addressbits\)\[256\] =' drivers/mtd/nand/nand_ecc.c
    defsnc 'static struct pinmux_cfg_reg pinmux_config_regs\[\] =' arch/sh/kernel/cpu/sh2a/pinmux-sh7203.c
    defsnc '	static const u8 e_keymap\[\] =' drivers/hid/hid-lg.c
    defsnc '		*struct phy_reg phy_reg_init_[01]\[\] =' drivers/net/r8169.c
    defsnc 'DEFINE_DEFAULT_PDR(0x0161, 256,' drivers/net/wireless/hermes_dld.c
    defsnc 'static const int isink_cur\[\] =' drivers/regulator/wm8350-regulator.c
    defsnc 'static const s16 \(converge_speed_ipb\?\|LAMBDA_table\[4\]\)\[101\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static const u32 addrinctab\[33\]\[2\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static const u8 \(default_intra_quant_table\|\(val\|bits\)_[ad]c_\(lu\|chro\)minance\)\[\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static const int zz\[64\] =' drivers/staging/go7007/go7007-fw.c
    defsnc '	u16 pack\[\] =' drivers/staging/go7007/go7007-fw.c
    defsnc 'static u8 \(initial\|channel\)_registers\[\] =' 'drivers/staging/go7007/wis-\(ov7640\|saa7113\|tw2804\).c'
    defsnc 'u16 MTO_One_Exchange_Time_Tbl_[ls]\[MTO_MAX_FRAG_TH_LEVELS\]\[MTO_MAX_DATA_RATE_LEVELS\] =' drivers/staging/winbond/mto.c
    defsnc 'u32 \(al2230_txvga_data\|w89rf242_txvga_old_mapping\)\[\]\[2\] =' drivers/staging/winbond/reg.c
    defsnc 'static const UINT16 crc16tab\[256\] =' drivers/staging/wlan-ng/hfa384x.c
    defsnc 'static const UINT32 wep_crc32_table\[256\] =' drivers/staging/wlan-ng/p80211wep.c
    defsnc 'static const unsigned char wm_vol\[256\] =' sound/pci/ice1712/phase.c
    defsnc 'static const u16 wm8900_reg_defaults\[WM8900_MAXREG\] =' sound/soc/wm8900.c
    defsnc '} \(clk_sys_ratios\|bclk_divs\)\[\] =' sound/soc/wm8903.c
    defsnc 'static u8 af9015_ir_table_\(leadtek\|twinhan\|a_link\|msi\|mygictv\|kworld\)\[\] =' drivers/media/dvb/dvb-usb/af9015.h
    defsnc 'static struct snr_table \(qpsk\|qam\(16\|64\)\)_snr_table\[\] =' drivers/media/dvb/frontends/af9013_priv.h
    defsnc 'static struct regdesc \(ofsm_init\|tuner_init_\(env77h11d5\|mt2060\(\|_2\)\|mxl500\(3d\|5\)\|qt1010\|mc44s803\|unknown\|tda18271\)\)\[\] =' drivers/media/dvb/frontends/af9013_priv.h
    defsnc 'static u8 stv0288_earda_inittab\[\] =' drivers/media/dvb/frontends/eds1547.h
    defsnc 'static u8 serit_sp1511lhb_inittab\[\] =' drivers/media/dvb/frontends/si21xx.c
    defsnc 'static u8 stv0288_inittab\[\] =' drivers/media/dvb/frontends/stv0288.c

    # Suspicious, deblob for now, until contributor responds.
    # defsnc '	static u16 \(sr\|twinax\)_edc\[\] =' drivers/net/cxgb3/ael1002.cn
    # Non-Free license in entire file.
    blob 'static unsigned char xilinx_firm\(\|_4610\)\[\] = {'"$sepx$blobseq*$sepx"'};' 'drivers/staging/me4000/me4\(00\|61\)0_firmware\.h' # CONFIG_ME4000

    # Deblobbing needed.
    blob 'static u8 \(Mojave\|Oasis\)UCode\[2\]\[65536\] ='"$sepx$blobseq*$sepx"';' 'drivers/staging/slicoss/\(gb\|oasis\(dbg\)\?\)download\.h' # CONFIG_SLICOSS
    blob 'static u8 \(GB\|Oasis\)RcvUCode\[2560\] ='"$sepx$blobseq*$sepx"';' 'drivers/staging/slicoss/\(gb\|oasis\)rcvucode\.h' # CONFIG_SLICOSS
    blob 'static unsigned char SaharaUCode\[2\]\[57972\] ='"$sepx$blobseq*$sepx"';' drivers/staging/sxg/saharadbgdownload.h # CONFIG_SXG
    blob 'static PHY_UCODE PhyUcode\[\] =[^;]*;' drivers/staging/sxg/sxgphycode.h # CONFIG_SXG

    # ok from earlier releases
    accept 'for i in [ 	0-9\\\n]*[\n]do' 'Documentation/specialix.txt|Documentation/serial/specialix.txt'
    defsnc 'static yyconst flex_int\(16\|32\)_t yy_[^[]*\[[0-9]*\] =' '.*\.lex\.c_shipped'
    defsnc 'static const yytype_u\?int\(8\|16\) yy[^\n []*\[\] =' '.*\.lex\.c_shipped'
    initnc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static const yytype_u\?int\(8\|16\) yy[^\n []*\[\] =[*][/];' '.*\.tab\.c_shipped'
    defsnc 'static struct cipher_testvec \(aes\|anubis\|bf\|camellia\|cts_mode\|des3_ede\|cast6\|salsa20_stream\|serpent\|tf\|tnepres\|xeta\|x\?tea\)\(_\(cbc\|ctr\|xts\)\)\?_\(enc\|dec\)_tv_template\[\] =' 'crypto/\(tcrypt\|testmgr\).h'
    defsnc 'static struct comp_testvec \(deflate\|lzo\)_\(de\)\?comp_tv_template\[\] =' 'crypto/\(tcrypt\|testmgr\).h'
    defsnc 'static struct hash_testvec \(aes_xcbc128\|crc32c\|hmac_sha2\(24\|56\)\|\(sha\|wp\)\(256\|384\|512\)\)_tv_template\[\] =' 'crypto/\(tcrypt\|testmgr\).h'
    defsnc 'static \(const \)\?RegInitializer initData\[\] __initdata =' 'drivers/ide/ali14xx\.c\|drivers/ide/legacy/ali14xx\.c'
    defsnc 'static const u8 setup\[\] =' 'drivers/ide/pci/delkin_cb\.c\|drivers/ide/delkin_cb\.c'
    defsnc 'static u8 cvs_time_value\[\]\[XFER_UDMA_6 - XFER_UDMA_0 + 1\] =' 'drivers/ide/sis5513\.c\|drivers/ide/pci/sis5513\.c'
    defsnc 'static u8 \(act\|ini\|rco\)_time_value\[\]\[8\] =' 'drivers/ide/sis5513\.c\|drivers/ide/pci/sis5513\.c'
    defsnc 'static const u8 speedtab \[3\]\[12\] =' 'drivers/ide/umc8672\.c\|drivers/ide/legacy/umc8672\.c'
    initnc 'static const __u8 \(effects\|gamma\)_table\[\(MAX_[A-Z]*\|[A-Z]*_MAX\)\]\[[0-9]*\] =' drivers/media/video/gspca/t631.c
    defsnc 'static const s8 \(b43\(\|legacy\)\|bcm43xx\)_tssi2dbm_[bg]_table\[\] =' net/wireless/b43/phy.c
    accept '#define _MAP_0_32_ASCII_SEG7_NON_PRINTABLE	\\[\n]	\(0,\)\+'"$eol" 'drivers/input/misc/map_to_7segment\.h\|include/linux/map_to_7segment\.h'
    accept '[ *	]*0                   1                   2                   3[\n][ *	]*0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1' 'net/\(netfilter\|ipv4\)/ipvs/ip_vs_sync.c|net/sctp/sm_make_chunk.c|include/linux/scpt.h'
    defsnc 'static const unsigned char wm_vol\[256\] =' sound/pci/ice1712/phase.c
    defsnc 'static const char zr360[56]0_dht\[0x1a4\] =' 'drivers/media/video/zr36060\.c\|drivers/media/video/zoran/zr36060\.c'
    defsnc 'static const char zr360[56]0_dqt\[0x86\] =' 'drivers/media/video/zr36060\.c\|drivers/media/video/zoran/zr36060\.c'

    # These are removed in 2.6.28, they're here so --reverse-patch tests pass.
    defsnc 'static unsigned char irq_xlate\[32\] =' arch/sparc/kernel/sun4m_irq.c
    defsnc 'static int logitech_expanded_keymap\[LOGITECH_EXPANDED_KEYMAP_SIZE\] =' drivers/hid/hid-input.c
    initc '	static const __u8 \(read_indexs\|n\(set\)\?[0-9]*\|missing\)\[[0-9x]*\] =' drivers/media/video/gspca/t613.c
    defsnc 'static const u_char nand_ecc_precalc_table\[\] =' drivers/mtd/nand/nand_ecc.c
    oprepline '#define AR5K_RATES_\(11[ABG]\|TURBO\|XR\) ' drivers/net/wireless/ath5k/ath5k.h
    defsnc 'static const struct ath_hal ar5416hal =' drivers/net/wireless/ath9k/hw.c
    defsnc 'const unsigned char INIT_2\[127\] =' drivers/video/omap/lcd_sx1.c

    initc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static const __u8 ov7630_sensor_init\[\]\[8\] = {[*][/];' drivers/media/video/gspca/sonixj.c
    ;;

  */patch*2.6.27-rc* | */patch*2.6.26-git* | */git-linus.diff)
    accept '	\.section __ex_table,"a"'"$sepx$blobpat*" 'arch/x86/lib/copy_user_\(nocache_\)\?64.S'
    initnc 'static struct cipher_testvec des3_ede_cbc_\(enc\|dec\)_tv_template\[\] =' crypto/tcrypt.h
    accept 'desc_config1:[\n]	\.byte 0x09, 0x02'"$sepx$blobpat*" 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).S'
    accept 'string_mfg:[\n]\?\(;\?	\.byte[^\n]*[\n]\)\+string_mfg_end:' 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).S'
    accept 'string_product:[\n]\?\(;\?	\.byte[^\n]*[\n]\)\+string_product_end:' 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).S'
    accept ':03000000020200F9[\n]:040023000205\(9B0037\|5F0073\)[\n]\(:050030000000000000CB[\n]\|:0400430002010000B6[\n]\)*'"$sepx$blobpat*"'[\n]:\(0E06E0006400670065007400060334003700F4\|0606A000060334003700E0\)[\n]:00000001FF[\n]' 'firmware/keyspan_pda/\(keyspan_pda\|xircom_pgs\).HEX'
    accept ':100000000C004000000000000000000000000000A4[\n]'"$sepx$blobpat*"'[\n]\/\* DSP56001 bootstrap code \*\/' firmware/dsp56k/bootstrap.bin.ihex
    initnc 'static const u16 uda1380_reg\[UDA1380_CACHEREGNUM\] =' sound/soc/codecs/uda1380.c
    initnc 'static const u16 wm8510_reg\[WM8510_CACHEREGNUM\] =' sound/soc/codecs/wm8510.c
    initnc 'static const unsigned short atkbd_set[23]_keycode\[512\] =' drivers/input/keyboard/atkbd.c
    initnc 'static const unsigned short atkbd_unxlate_table\[128\] =' drivers/input/keyboard/atkbd.c
    initnc 'static const unsigned char usb_kbd_keycode\[256\] =' drivers/hid/usbhid/usbkbd.c
    initnc '		u8 buf, bufs\[\] =' drivers/media/dvb/dvb-usb/cxusb.c
    initnc 'static struct dvb_pll_desc [^\n]* =' drivers/media/dvb/frontends/dvb-pll.c
    initnc '	static int sysdiv_to_div_x_2\[\] =' arch/powerpc/platforms/512x/clock.c
    defsnc 'static const __u8 cx_inits_\(176\|320\|352\|640\)\[\] =' drivers/media/video/gspca/conex.c
    defsnc 'static const __u8 cx_jpeg_init\[\]\[8\] =' drivers/media/video/gspca/conex.c
    defsnc 'static const __u8 cxjpeg_\(640\|352\|320\|176\|qtable\)\[\]\[8\] =' drivers/media/video/gspca/conex.c
    initnc 'static const unsigned char quant\[\]\[0x88\] =' drivers/media/video/gspca/jpeg.h
    initnc 'static unsigned char huffman\[\] =' drivers/media/video/gspca/jpeg.h
    initc '	\?static const struct ov_i2c_regvals norm_76[1247]0\[\] =' drivers/media/video/gspca/ov519.c
    initnc 'static const __u8 pac207_sensor_init\[\]\[8\] =' drivers/media/video/gspca/pac207.c
    initnc 'static const __u8 pac7311_jpeg_header\[\] =' drivers/media/video/gspca/pac7311.c
    initnc 'static const __u8 \(start\|page[34]\)_73\(02\|11\)\[\] =' drivers/media/video/gspca/pac7311.c
    initnc 'static const __u8 init\(Hv7131\|Ov\(6650\|7630\(_3\)\?\)\|Pas\(106\|202\)\|Tas51[13]0\)\[\] =' drivers/media/video/gspca/sonixb.c
    initnc 'static const __u8 \(hv7131\|ov\(6650\|7630\(_3\)\?\)\|pas\(106\|202\)\|tas51[13]0\)_sensor_init\(_com\)\?\[\]\[8\] =' drivers/media/video/gspca/sonixb.c
    defsnc 'static \(const \)\?__u8 \(hv7131r\|mi0360\|mo4000\|ov76\([36]0\|48\)\|om6802\)_sensor_init\[\]\[8\] =' drivers/media/video/gspca/sonixj.c
    initnc 'static const __u8 qtable4\[\] =' drivers/media/video/gspca/sonixj.c
    initnc 'static const __u16 \(spca500_visual\|Clicksmart510\)_defaults\[\]\[3\] =' drivers/media/video/gspca/spca500.c
    initnc 'static const __u8 qtable_\(creative_pccam\|kodak_ez200\|pocketdv\)\[2\]\[64\] =' drivers/media/video/gspca/spca500.c
    initnc 'static const __u16 spca501c\?_\(\(3com\|arowana\|mysterious\)_\)\?\(init\|open\)_data\[\]\[3\] =' drivers/media/video/gspca/spca501.c
    initnc 'static const __u16 spca505b\?_\(init\|open\)_data\(_ccd\)\?\[\]\[3\] =' drivers/media/video/gspca/spca505.c
    initnc 'static const __u16 spca508\(cs110\|_sightcam2\?\|_vista\)\?_init_data\[\]\[3\] =' drivers/media/video/gspca/spca508.c
    initnc 'static const __u16 spca561_init_data\[\]\[2\] =' drivers/media/video/gspca/spca561.c
    initnc 'static const __u16 spca504\(_pccam600\|A_clicksmart420\)_\(init\|open\)_data\[\]\[3\] =' drivers/media/video/gspca/sunplus.c
    initnc 'static const __u8 qtable_\(creative_pccam\|spca504_default\)\[2\]\[64\] =' drivers/media/video/gspca/sunplus.c
    initnc 'static const __u8 \(effects\|gamma\)_table\[MAX_[A-Z]*\]\[[0-9]*\] =' drivers/media/video/gspca/t631.c
    initnc 'static const __u8 tas5130a_sensor_init\[\]\[8\] =' drivers/media/video/gspca/t613.c
    initnc '	static const __u8 \(read_indexs\|n\(set\)\?[0-9]*\|missing\)\[[0-9x]*\] =' drivers/media/video/gspca/t613.c
    initc 'static const __u8 \(mi13[12]0\|po3130\|hv7131r\|ov76[67]0\)_\(\(soc\)\?initQ\?VGA_\(JPG\|data\)\|rundata\)\[\]\[4\] =' drivers/media/video/gspca/vc032x.c
    initnc 'static const struct usb_action \(cs2102\|hdcs2020xx\|icm105axx\|ov7630c\|pb0330[3x]x\)_Initial\(Scale\)\?\[\] =' drivers/media/video/gspca/zc3xx.c
    initnc 'static const u8 rtl8225z2_agc\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_ofdm\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_tx_power_cck\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_tx_power_cck_ch14\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const __u16 t10_dif_crc_table\[256\] =' lib/crc-t10dif.c
    initnc 'static crb_128M_2M_block_map_t crb_128M_2M_map\[64\] =' drivers/net/netxen/netxen_hw.c
    initnc 'static const __u16 crc10_table\[256\] =' drivers/usb/serial/safe_serial.c
    accept '[ 	]*\( *0\)*\( *1\)*[\n][ 	]*0 1 2 3 4 5 6 7 8 9 0 1 *2 3 4 5 6 7' 'Documentation/bt8xxgpio.txt'
    initnc '	static int exp_lut\[256\] =' drivers/isdn/mISDN/dsp_audio.c
    initnc 'static const u32 bf_pbox\[16 \+ 2\] =' drivers/isdn/mISDN/dsp_blowfish.c
    initnc 'static const u32 bf_sbox\[256 \* 4\] =' drivers/isdn/mISDN/dsp_blowfish.c
    initnc 'static u8 sample_\(german_\(all\|old\)\|american_\(dialtone\|ringing\|busy\)\|special[123]\|silence\)\[\] =' drivers/isdn/mISDN/dsp_tones.c
    initnc 'struct pattern {[^}]*int tone;[^}]*} pattern\[\] =' drivers/isdn/mISDN/dsp_tones.c
    initnc 'static u8 \([au]\|_4\)law_to_\([ua]law\|4bit\)\[256\] =' drivers/isdn/mISDN/l1oip_codec.c
    initnc 'static unsigned char banner_table\[\] =' arch/sh/boards/mach-microdev/led.c
    initnc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static const \(yytype_u\?int\(8\|16\)\|\(unsigned \)\?\(short\( int\)\?\|char\)\) yy[^[]*\[\] =[*][/];' scripts/genksyms/parse.c_shipped
    accept 'irq_prio_\([hdl]\|l[cd]\):'"$sepx$blobpat*" arch/arm/inlcude/asm/hardware/entry-macro-iomd.S
    defsnc '	static const int desc_idx_table\[\] =' arch/arm/include/asm/hardware/iop3xx-adma.h
    defsnc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static const __u8 \(hv7131r\|mi0360\|mo4000\|ov76\(60\|48\)\)_sensor_init\[\]\[8\] = {[*][/];' drivers/media/video/gspca/sonixj.c
    defsnc 'static const struct ath_hal ar5416hal =' drivers/net/wireless/ath9k/hw.c
    defsnc 'static \(const \)\?u32 ar\(5416\|9280\)\(Modes\(_fast_clock\)\?\|Common\|BB_RfGain\|Bank6\(TPC\)\?\|Addac\)\(_91[06]0\(1_1\)\?\|_9280\(_2\)\?\)\?\[\]\[[236]\] =' drivers/net/wireless/ath9k/initvals.h
    ;;
    
  */linux-2.6-gspca-git.patch)
    # Probably for 2.6.28 or .29.
    initnc 'static const __u8 ov\(534\|772x\)_reg_initdata\[\]\[2\] =' drivers/media/video/gspca/ov534.c
    initnc 'static const __u8 \(mi0360\|po1200\)_initQ\?VGA_\(JPG\|data\)\[\]\[4\] =' drivers/media/video/gspca/vc032x.c
    # Already in 2.6.27.
    initnc 'static const __u8 initOv6650\[\] =' drivers/media/video/gspca/sonixb.c
    initnc '	[/][*] Some more unknown stuff [*][/]' drivers/media/video/gspca/sonixb.c
    defsnc 'static const __u8 ov7648_sensor_init\[\]\[8\] =' drivers/media/video/gspca/sonixj.c
    # No merge needed
    defsnc '#if 0[\n]	{0x30, 0x0154, 0x0008},' drivers/media/video/gspca/sunplus.c
    ;;

  */drm-modesetting-radeon.patch)
    initnc 'static int atom_dst_to_src\[8\]\[4\] =' drivers/gpu/drm/radeon/atom.c
    ;;

  */linux*alsa*.patch)
    defsnc 'static u8 tas3004_treble_table\[\] =' sound/aoa/codecs/tas-basstreble.h
    defsnc 'static const unsigned char wm_vol\[256\] =' sound/pci/ice1712/phase.c
    defsnc 'static const u16 wm8900_reg_defaults\[WM8900_MAXREG\] =' sound/soc/wm8900.c
    defsnc '} \(clk_sys_ratios\|bclk_divs\)\[\] =' sound/soc/wm8903.c
    ;;

  */patch*2.6.26-rc*)
    initnc 'static u64 vec2off\[68\] =' arch/ia64/kvm/process.c
    initnc "			interrupts = <\\(0x\\)\\?3 \\(0x\\)\\?0 \\(0x\\)\\?0  $blobpat*>;" 'arch/powerpc/boot/dts/\(cm5200\|lite5200b\?\|kuroboxHG\|pcm030\|tqm5200\).dts'
    initnc 'static const u32 crctab32\[\] =' arch/x86/boot/tools/build.c
    initnc 'static const u64 sha512_K\[80\] =' 'crypto/sha512\(_generic\)\?.c'
    initnc 'static struct hash_testvec \(hmac_sha\(224\|256\)\|aes_xcbc128\|crc32c\)_tv_template\[\] =' crypto/tcrypt.h
    initnc 'static struct cipher_testvec \(bf_cbc\|serpent\|tnepres\|aes\(_\(cbc\|ctr\|xts\)\)\?\|x\?tea\|anubis\(_cbc\)\?\|xeta\|camellia_cbc\|cts_mode\)_\(enc\|dec\)_tv_template\[\] =' crypto/tcrypt.h
    initnc '		\.\(digest\|entries\|input\|key\|output\|plaintext\|result\)[ 	]*= [{"]' crypto/tcrypt.h
    initnc 'static const u8 speedtab \[3\]\[12\] =' drivers/ide/legacy/umc8672.c
    initnc 'static u8 cvs_time_value\[\]\[XFER_UDMA_6 - XFER_UDMA_0 + 1\] =' drivers/ide/pci/sis5513.c
    initnc 'static u8 \(ini\|act\|rco\)_time_value\[\]\[8\] =' drivers/ide/pci/sis5513.c
    initnc 'static u8 mt2131_config1\[\] =' drivers/media/common/tuners/mt2131.c
    initnc 'static u8 mt2266_init2\[\] =' drivers/media/common/tuners/mt2266.c
    initnc 'u16 e1000_igp_cable_length_table\[IGP01E1000_AGC_LENGTH_TABLE_SIZE\] =' drivers/net/e1000/e1000_hw.c
    initnc '\(uint16_t\|u16\) e1000_igp_2_cable_length_table\[IGP02E1000_AGC_LENGTH_TABLE_SIZE\] =' drivers/net/e1000/e1000_hw.c # u16 on 2.6.26
    oprepline '#define AR5K_RATES_11[ABG] ' drivers/net/wireless/ath5k/ath5k.h
    oprepline '	{ 1, MODULATION_XR, 1000, 2, 139, 1 },	' drivers/net/wireless/ath5k/ath5k.h
    initnc 'static const struct ath5k_ini_mode rf\(5413\|24\(13\|25\)\)_ini_mode_end\[\] =' drivers/net/wireless/ath5k/initvals.c
    initnc 'static yyconst flex_int\(16\|32\)_t yy_[^[]*\[[0-9]*\] =' '.*\.lex\.c_shipped'
    initnc 'static const yytype_u\?int\(8\|16\) yy[^\n []*\[\] =' '.*\.lex\.c_shipped'
    # new in 2.6.26
    initnc 'static struct mse2snr_tab \(vsb\|qam\(64\|256\)\)_mse2snr_tab\[\] =' drivers/media/dvb/frontends/au8522.c
    initnc '} \(VSB\|QAM\)_mod_tab\[\] =' drivers/media/dvb/frontends/au8522.c
    initnc '} itd1000_\(lpf_pga\|fre_values\)\[\] =' drivers/media/dvb/frontends/itd1000.c
    initnc '} \(vsb\|qam\(64\|256\)\)_snr_tab\[\] =' drivers/media/dvb/frontends/s5h1411.c
    initnc '} snr_tab\[\] =' drivers/media/dvb/frontends/tda10048.c
    initnc '	static const u8 biphase_tbl\[\] =' drivers/media/video/cx18/cx18-av-vbi.c
    initnc '	static const u8 mpeg_hdr_data\[\] =' drivers/media/video/cx18/cx18-vbi.c
    initnc 'static u32 reg_init_initialize\[\] =' drivers/media/video/saa717x.c
    initnc '	} vals\[\] =' drivers/media/video/saa717x.c
    initnc 'static const u32 \(main\|gear\)_seedset\[BACKOFF_SEEDSET_ROWS\]\[BACKOFF_SEEDSET_LFSRS\] =' drivers/net/forcedeth.c
    blob 'unsigned char \(IDX_ACTIVATE_\(READ\|WRITE\)\|\(CM\|ULP\)_\(ENABLE\|SETUP\)\|DM_ACT\) = '"$sepx$blobseq*$sepx;" drivers/s390/net/qeth_core_mpc.c # from drivers/s390/net/qeth_mpc.c in 2.6.25
    initnc '} pll_table\[\] =' drivers/video/geode/lxfb_ops.c
    accept "  { 0x00014284,  19688 },[\n]  { 0x00011104,  20400 },[\n]  { $blobpat* }," drivers/video/geode/lxfb_ops.c # won't be necessary in rc3
    initnc 'static const u16 wm9713_reg\[\] =' sound/soc/codecs/wm9713.c
    accept 'P[13]\([\n]#[^\n]*\)*[\n]*\([\n][0-9 ]*\)\+' drivers/video/logo/logo_blackfin_clut224.ppm
    ;;
  */patch*2.6.25-rc*)
    initnc ';[/][*]@@ -[0-9]*,[0-9]* +[0-9]*,[0-9]* @@ static uchar sbox\[8\]\[4\]\[16\] = {[*][/];'
    accept '	\$3 = {{pge = {{ste = {\(\([0-9][0-9a-fx{},\n 	]*\|\(pge\|ste\) =\|<repeats [0-9]\+ times>\)[{},\n 	]*\)*<repeats 11 times>}'"$eol"
    initnc 'static yyconst flex_int\(16\|32\)_t yy_[^[]*\[[0-9]*\] ='
    initnc 'static const yytype_u\?int\(8\|16\) yy[^[]*\[\] ='
    initnc '	int bcomm_irq\[3\*16\] ='
    initnc '	static const int8 countLeadingZerosHigh\[\] ='
    initnc 'static unsigned long shmedia_opcode_table\[64\] ='
    initnc 'u_char const data_sizes_16\[32\] ='
    initnc 'static u_char const data_sizes_32\[32\] ='
    initnc '		\.\(digest\|entries\|input\|key\|output\|plaintext\|result\)[ 	]*= {'
    initnc 'static struct [^\n]*_testvec [^\n]*_tv_template\[\] ='
    initnc 'static struct nic_qp_map nic_qp_mapping_[01]\[\] ='
    initnc 'static u8 mt2266_init2\[\] ='
    initnc 'static struct regval ov_initvals\[\] ='
    initnc 'static struct regval stk1125_initvals\[\] ='
    initnc 'static u8 bnx2x_stats_len_arr\[BNX2X_NUM_STATS\] ='
    initnc 'static const struct arb_line read_arb_data\[NUM_RD_Q\]\[MAX_RD_ORD + 1\] ='
    initnc 'static const struct arb_line write_arb_data\[NUM_WR_Q\]\[MAX_WR_ORD + 1\] ='
    initnc 'uint16_t e1000_igp_cable_length_table\[IGP01E1000_AGC_LENGTH_TABLE_SIZE\] ='
    initnc 'uint16_t e1000_igp_2_cable_length_table\[IGP02E1000_AGC_LENGTH_TABLE_SIZE\] ='
    oprepline '#define AR5K_RATES_11\([ABG]\|TURBO\|XR\) ' drivers/net/wireless/ath5k/ath5k.h
    initnc '		} blinkrates\[\] ='
    initnc 'static const struct ath5k_ini ar5212_ini\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5111\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5112\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5112a\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5413\[\] ='
    initnc 'static const u16 rtl8225bcd_rxgain\[\] ='
    initnc 'static const u8 rtl8225_agc\[\] ='
    initnc 'static const u8 rtl8225_tx_power_cck\[\] ='
    initnc 'static const u8 rtl8225_tx_power_cck_ch14\[\] ='
    initnc 'static const u16 rtl8225z2_rxgain\[\] ='
    accept '     \( 49,\)*[\n]\([ 0-9,]*[\n]\)*     \( 49,\)*'"$eol"
    initnc 'static const unsigned char wm_vol\[256\] ='
    accept 'domain<N> <cpumask> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36'"$eol"
    # drivers/net/e1000e/phy.c
    initnc 'static const u16 e1000_igp_2_cable_length_table\[\] ='
    accept '	24 => \[[\n]\([^\n]*[\n]\)*	\]\(, [0-9]\+ => \[\)\?'"$eol"
    accept '		'"'"'0x[^\n]*[\n]\([^\n]*[\n]\)*	\]\(, [0-9]\+ => \[\)\?'"$eol"
    initnc 'const u\(8\|16\|32\) b43_ntab_\(\(adjustpower\|estimatepowerlt\|gainctl\|iqlt\|loftlt\|noisevar1\|tdi[24]0a\)[01]\|channelest\|frame\(lookup\|struct\)\|mcs\|pilot\|tdtrn\|tmap\)\[\] ='
    ;;
  */*drm*.patch)
    # linux-2.6-drm-i915-modeset.patch, nouveau-drm*.patch,
    # drm-fedora9-rollup.patch
    initnc 'static const u32 filter_table\[\] =' drivers/char/drm/intel_tv.c
    initnc '\(static uint32_t\|}\) nv04_graph_ctx_regs \[\] =' drivers/char/drm/nv04_graph.c
    initnc 'static int nv10_graph_ctx_regs \[\] =' drivers/char/drm/nv10_graph.c

    # Although the developers of the drivers are not trying to stop
    # anyone from modifying it or understanding it, they acknowledge
    # these are bits of code, obtained through mmio interactions.
    # This means these blobs are not source code, AND original authors
    # of the blobs have power to stop others from modifying them.
    # Non-Free software, for sure.

    # initnc 'static uint32_t nv\(4[013467ace]\|49_4b\|8[46]\)_ctx_\(voodoo\|prog\)\[\] =' 'drivers/char/drm/nv40_graph.c|.*'
    ;;
  */linux-2.6*-lirc.patch)
    initnc 'const unsigned char map_table\[\] ='
    ;;
  */linux-2.6-modsign-mpilib.patch)
    initnc 'const unsigned char __clz_tab\[\] ='
    ;;
  */linux-2.6-netdev*.patch | \
  */linux-2.6.27-net-r8169-2.6.28.patch)
    defsnc '		*struct phy_reg phy_reg_init_[01]\[\] =' drivers/net/r8169.c
    ;;
  */linux-2.6-wireless*.patch | */linux-2.6-ath5k.patch | \
  */git-wireless-dev.patch | */linux-2.6-zd1211rw-mac80211.patch)
    initnc 'const u\(8\|16\|32\) b43_ntab_\(\(adjustpower\|estimatepowerlt\|gainctl\|iqlt\|loftlt\|noisevar1\|tdi[24]0a\)[01]\|channelest\|frame\(lookup\|struct\)\|mcs\|pilot\|tdtrn\|tmap\)\[\] ='
    initnc 'static const s8 \(b43\(legacy\)\?\|bcm43xx\)_tssi2dbm_[bg]_table\[\] ='
    initnc 'static struct iwl\(3945\)\?_tx_power power_gain_table\[2\]\[IWL_MAX_GAIN_ENTRIES\] ='
    initnc 'static const struct gain_entry gain_table\[2\]\[108\] ='
    initnc 'static const struct rf_channel rf_vals_5222\[\] ='
    initnc 'static const struct rf_channel rf_vals_5225_2527\[\] =' drivers/net/wireless/rt2x00/rt73usb.c
    initnc 'static const struct rf_channel rf_vals_5226\[\] =' drivers/net/wireless/rt2x00/rt73usb.c
    initnc 'static const struct rf_channel rf_vals_bg\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2522\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2523\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2524\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2525\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2525e\[\] ='
    initnc 'static const struct rf_channel rf_vals_bg_2528\[\] =' drivers/net/wireless/rt2x00/rt73usb.c
    initnc 'static const struct rf_channel rf_vals_noseq\[\] ='
    initnc 'static const struct rf_channel rf_vals_seq\[\] ='
    initnc '	static const u8 t\[\] ='
    initnc 'static const u16 rtl8225bcd_rxgain\[\] ='
    initnc 'static const u8 rtl8225_agc\[\] ='
    initnc 'static const u8 rtl8225_tx_power_cck\[\] ='
    initnc 'static const u8 rtl8225_tx_power_cck_ch14\[\] ='
    initnc 'static const u16 rtl8225z2_rxgain\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5111\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5112\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5112a\[\] ='
    initnc 'static const struct ath5k_ini_rf rfregs_5413\[\] ='
    oprepline '#define AR5K_RATES_11A '
    oprepline '#define AR5K_RATES_11B '
    oprepline '#define AR5K_RATES_11G '
    oprepline '#define AR5K_RATES_TURBO '
    oprepline '#define AR5K_RATES_XR '
    initnc 'static const struct ath5k_ini ar5212_ini\[\] ='
    initnc 'static const struct ath5k_ini_mode rf\(5413\|24\(13\|25\)\)_ini_mode_end\[\] =' drivers/net/wireless/ath5k/initvals.c # ?
    initnc '		} blinkrates\[\] ='

    initnc 'static const u8 rtl8225z2_agc\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_ofdm\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_tx_power_cck\[\] =' drivers/net/wireless/rtl8187_rtl8225.c
    initnc 'static const u8 rtl8225z2_tx_power_cck_ch14\[\] =' drivers/net/wireless/rtl8187_rtl8225.c

    # git logs
    accept '   sudo modprobe ath5k debug=0x00000400[\n][ 	]*[\n]\([ 	]*Band[^\n]*[\n]\([ 	]*\(\(channels\|rates\):\|[- 	0-9a-f]*\|\[\.\.\. etc \]\)[\n]\)\+\)\+       540 000c 0000 0000'
    oprepline '	{ 1, MODULATION_XR, 3000, 1, 150, 3 },'

    # Fedora 8ish kernel-xen builds
    initnc 'const u16 crc_itu_t_table\[256\] ='
    initnc 'static const u16 tkip_sbox\[256\] ='
    initnc 'static const struct ath5k_ini_mode ar5211_ini_mode\[\] ='
    initnc 'static const struct ath5k_ini_mode ar5212_rf511[12]_ini_mode\[\] ='
    initnc '	static const u8 log10\[\] ='
    initnc 'static const u8 rtl8225z2_tx_gain_cck_ofdm\[\] ='
    initnc 'static const u32 rf_vals_abg_5222\[\] ='
    ;;

  */linux-2.6-netdev-e1000e*.patch)
    # drivers/net/e1000e/phy.c
    initnc 'static const u16 e1000_igp_2_cable_length_table\[\] ='
    ;;
  esac
}  

# Regular expression that matches a literal constant.
constx="[0-9][0-9a-fA-FxX]*"
# Regular expression that matches a separator between consecutive
# literal constants.
sepx="\\([,:{} 	\\nLlUu\"\'\\\\]\\+[xX\$]\\?\\|[ 	\\n]*[.][a-zA-Z][a-zA-Z0-9]*[ 	]\\+[\$]\\?\\)"

# Regular expression that matches a continuation of a blob, after an
# initial constant.  *, \+ and \? can be safely appended to it without
# \(\)s.
blobcont="\\($sepx$constx\\)"

# Regular expression that matches the initial constant of a blob plus
# its continuation.  *, \+ and \? can be safely appended to it without
# \(\)s.
blobpat="$constx$blobcont"

# Regular expression that matches a blob with the exact number of
# constants specified as sensitivity.
blobseq="$blobpat\\{$sens\\}"

# Regular expression that matches a blob with the exact specified
# length, or longer.
blobfseq="$blobseq$blobcont*"

# Regular expression that matches the beginning of the pattern or a
# line break.  It must be \(\)ed, such that it can be named in
# replacement patterns without being named.
bol="\\(^\\|[\\n]\\)"

# Regular expression that matches the end of the pattern or a line
# break.  It must be \(\)ed, such that it can be named in replacement
# patterns without being named.
eol="\\([\\n]\\|\$\\)"

# Regular expression that matches a C-style comment.
comment="\\([/][*]\\([^*]*\\|[*]\\+[^/*]\\)*[*]\\+[/]\\|[/][/][^\\n]*[\\n]\\)"

# Regular expression that matches comments typically used in assembly.
asmcomment="\\($comment\\|[;#][^\\n]*[\\n]\\)"

# Regular expression that matches a braced initializer containing at
# least one blob.
initblob="[^\\n]*=\\([ 	\\n\\\\]*\\|$comment\\)*{\\([^;]*\\|$comment\\)*$blobseq\\([^;]*\\|$comment\\)*}\\?\\([ 	\\n\\\\]*\\|$comment\\);\\?"

# Regular expression that matches a C (possibly multi-line) #define
# that contains a blob.
defineblob='[ 	]*#[ 	]*define[ 	]\+\([^\n]*\\[\n]\)*[^\n]*'"$blobseq"'\([^\n]*\\[\n]\)*'

# Regular expression that matches an assembly label followed by a blob
# without any intervening label.
asmblob="[a-zA-Z_.][^\\n:;#/ 	]*[ ]*:\\([^:{}]*\\|$asmcomment\\)*$blobseq\\([^:]*\\|$asmcomment\\)*"

# Set up the sed script that will go through the (processed) input,
# looking for sequences of blobs and printing whatever was requested.
# It accepts 3 arguments.

# $1 is the action in case blobs were found in the input.

# $2 is the action in case no blobs were found, not even false positives.

# $3 is the action in case false positives were located.

# $4 is the action for every complete input pattern.

set_sedmain () {
  falsepos=`sed 's,^\\\|,,;s,^.,\\\\(&,;s,.$,&\\\\),' < "$falsepos_name"`
  orfalseneg=`cat < "$falseneg_name"`

  case $orfalseneg in
  "")
      blobfast=$blobseq
      bloblong=$blobfseq
      ;;
  *)
      blobfast="\\($blobseq$orfalseneg\\)"
      bloblong="\\($blobfseq$orfalseneg\\)"
      ;;
  esac

  # Regular expression that matches one or more blobs without
  # intervening line breaks.
  sblobctx="\\([^\\n]*$bloblong\\)\\+"

  # Regular expression that matches the context for a long blob match.
  lblobctx="\\($initblob\\|$defineblob\\|$asmblob\\|$sblobctx\\)"

  if test -s "$falsepos_name"; then
    check_false_positives="$v:???falsepos
/$bol$falsepos/!b blob;
$v:+++falsepos
h;
s/$bol$falsepos/\\1;\/**\/;/g;
# See if, after removing all matches, we end up without any blobs.
$v:???blobfast
/$blobfast/!{
  g;
  b falsepos;
}
g;
"
  else
    falsepos="$^"
    check_false_positives=
  fi

  sedmain="
/^[\n]\?;[/][*]\\(end .*\\)\\?[*][/];$/{
  $4;
  d;
}
/^;[/][*]begin /!{
  : internal_error
  i\\
Internal error at
  p;
  q 2;
}
$v:reading file in
h;
n;
: read_more
/^;[/][*]end [^\\n]*[*][/];$/! {
  H;
  n;
  b read_more;
}
H;
g;
$4
s/^\(;[/][*]begin [^\n]*[\n]\)*//;
s/\\($bol;[/][*]\\(end [^\n]*\\)\\?[*][/];\\)*$//;
$v:???!blobfast
/$blobfast/!b clean;
$check_false_positives
# Fall through.
: blob
$v:blob
$1
d;
: clean
$2
d;
: falsepos
$v:falsepos
$3
d;

: print_matches
$v:print_matches
/^$falsepos/! {
  $v:delete unmatching lines
  h;
  s/[\\n]$falsepos.*//;
  : print_matches_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_matches_nomatch_loop;
  }
  x;
  b print_matches_delete_to_eol;
}
h;
s/^\\($falsepos[^\\n]*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to match
/$bloblong/ {
  i\\
::: $file :::
  p;
}
g;
s/^\\($falsepos[^\\n]*\\)//;
: print_matches_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_matches;

: print_marked_matches
$v:print_marked_matches
/^$falsepos/! {
  h;
  s/[\\n]$falsepos.*//;
  : print_marked_matches_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_marked_matches_nomatch_loop;
  }
  x;
  b print_marked_matches_delete_to_eol;
}
h;
s/^\\($falsepos[^\\n]*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to match
/$bloblong/{
  i\\
::: $file :::
  s/{\\($sepx\\)\\?$blobfseq\\($sepx\\)\\?}[ 	]*;/{\/*(DEBLOBBED)*\/};/g;
  s/$bloblong/\/*(DEBLOBBED)*\//g;
  p;
}
g;
s/^\\($falsepos[^\\n]*\\)//;
: print_marked_matches_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_marked_matches;

: print_blobs
$v:print_blobs
/^$falsepos/ {
  $v:delete false positive
  # This is tricky.  We don't want to print the false positive.
  /^$falsepos[^\\n]*$blobfast/ {
    $v:delete false positive immediately followed by blob
    h;
    s/^\\($falsepos\\).*/\\1/;
    $v:matched false positive
    : print_blobs_match_loop
    /[\\n]/ {
      s/^[^\\n]*[\\n]//;
      x;
      s/^[^\\n]*[\\n]//;
      x;
      b print_blobs_match_loop;
    }
    G;
    b print_blobs_delete_to_eol;
  }
  s/^$falsepos//;
  b print_blobs_delete_to_eol;
}
/^[^\\n]*$blobfast/! {
  $v:delete non-blob header
  h;
  s/[\\n]\\($falsepos\\|[^\\n]*$blobfast\\).*//;
  $v:matched non-blob header
  : print_blobs_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_blobs_nomatch_loop;
  }
  x;
  b print_blobs_delete_to_eol;
}
h;
i\\
::: $file :::
s/^\\([^\\n]*\\($bloblong[^\\n]*\\)\\+\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
p;
g;
s/^\\([^\\n]*\\($bloblong[^\\n]*\\)\\+\\)//;
: print_blobs_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_blobs;

: print_marked_blobs
$v:print_marked_blobs
/^$falsepos/ {
  $v:delete false positive
  # This is tricky.  We don't want to print the false positive.
  /^$falsepos[^\\n]*$blobfast/ {
    $v:delete false positive immediately followed by blob
    h;
    s/^\\($falsepos\\).*/\\1/;
    $v:matched false positive
    : print_marked_blobs_match_loop
    /[\\n]/ {
      s/^[^\\n]*[\\n]//;
      x;
      s/^[^\\n]*[\\n]//;
      x;
      b print_marked_blobs_match_loop;
    }
    G;
    b print_marked_blobs_delete_to_eol;
  }
  s/^falsepos//;
  b print_marked_blobs_delete_to_eol;
}
/^[^\\n]*$blobfast/! {
  $v:delete non-blob header
  h;
  s/[\\n]\\($falsepos\\|[^\\n]*$blobfast\\).*//;
  $v:matched non-blob header
  : print_marked_blobs_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_marked_blobs_nomatch_loop;
  }
  x;
  b print_marked_blobs_delete_to_eol;
}
h;
i\\
::: $file :::
s/^\\([^\\n]*\\($bloblong[^\\n]*\\)\\+\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
s/{\\($sepx\\)\\?$blobfseq\\($sepx\\)\\?}[ 	]*;/{\/*(DEBLOBBED)*\/};/g;
s/$bloblong/\/*(DEBLOBBED)*\//g;
p;
g;
s/^\\([^\\n]*\\($bloblong[^\\n]*\\)\\+\\)//;
: print_marked_blobs_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_marked_blobs;

: print_cblobs
$v:print_cblobs
/^$falsepos/ {
  $v:delete false positive
  # This is tricky.  We don't want to print the false positive.
  /^$falsepos[^\\n]*$blobfast/ {
    $v:delete false positive immediately followed by blob
    h;
    s/^\\($falsepos\\).*/\\1/;
    $v:matched false positive
    : print_cblobs_match_loop
    /[\\n]/ {
      s/^[^\\n]*[\\n]//;
      x;
      s/^[^\\n]*[\\n]//;
      x;
      b print_cblobs_match_loop;
    }
    G;
    b print_cblobs_delete_to_eol;
  }
  s/^$falsepos//;
  b print_cblobs_delete_to_eol;
}
/^$lblobctx/! {
  $v:delete non-blob header
  h;
  s/[\\n]\\($falsepos\\|$lblobctx\\).*//;
  $v:matched non-blob header
  : print_cblobs_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_cblobs_nomatch_loop;
  }
  x;
  b print_cblobs_delete_to_eol;
}
h;
i\\
::: $file :::
s/^\\($lblobctx[^\\n]*\\($bloblong[^\\n]*\\)*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
p;
g;
s/^\\($lblobctx[^\\n]*\\($bloblong[^\\n]*\\)*\\)//;
: print_cblobs_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_cblobs;

: print_marked_cblobs
$v:print_marked_cblobs
/^$falsepos/ {
  $v:delete false positive
  # This is tricky.  We don't want to print the false positive.
  /^$falsepos[^\\n]*$blobfast/ {
    $v:delete false positive immediately followed by blob
    h;
    s/^\\($falsepos\\).*/\\1/;
    $v:matched false positive
    : print_marked_cblobs_match_loop
    /[\\n]/ {
      s/^[^\\n]*[\\n]//;
      x;
      s/^[^\\n]*[\\n]//;
      x;
      b print_marked_cblobs_match_loop;
    }
    G;
    b print_marked_cblobs_delete_to_eol;
  }
  s/^$falsepos//;
  b print_marked_cblobs_delete_to_eol;
}
/^$lblobctx/! {
  $v:delete non-blob header
  h;
  s/[\\n]\\($falsepos\\|$lblobctx\\).*//;
  $v:matched non-blob header
  : print_marked_cblobs_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_marked_cblobs_nomatch_loop;
  }
  x;
  b print_marked_cblobs_delete_to_eol;
}
h;
i\\
::: $file :::
s/^\\($lblobctx[^\\n]*\\($bloblong[^\\n]*\\)*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
s/{\\($sepx\\)\\?$blobfseq\\($sepx\\)\\?}[ 	]*;/{\/*(DEBLOBBED)*\/};/g;
s/$bloblong/\/*(DEBLOBBED)*\//g;
p;
g;
s/^\\($lblobctx[^\\n]*\\($bloblong[^\\n]*\\)*\\)//;
: print_marked_cblobs_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_marked_cblobs;

: print_both
$v:print_both
/^\\($falsepos\\|[^\\n]*$blobfast\\)/! {
  $v:delete non-blob header
  h;
  s/[\\n]\\($falsepos\\|[^\\n]*$blobfast\\).*//;
  $v:matched non-blob header
  : print_both_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b print_both_nomatch_loop;
  }
  x;
  b print_both_delete_to_eol;
}
h;
i\\
::: $file :::
s/^\\(\\($falsepos[^\\n]*\\|[^\\n]*$bloblong[^\\n]*\\)\\($bloblong[^\\n]*\\)*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
p;
g;
s/^\\(\\($falsepos[^\\n]*\\|[^\\n]*$bloblong[^\\n]*\\)\\($bloblong[^\\n]*\\)*\\)//;
: print_both_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b print_both;

: list_matches
$v:list_matches
/^$falsepos/! {
  $v:print unmatching lines
  h;
  s/[\\n]$falsepos.*//;
  p;
  : list_matches_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b list_matches_nomatch_loop;
  }
  x;
  b list_matches_delete_to_eol;
}
h;
s/^\\($falsepos[^\\n]*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to match
/$bloblong/{
  s/{\\($sepx\\)\\?$blobfseq\\($sepx\\)\\?}[ 	]*;/{\/*(DEBLOBBED)*\/};/g;
  s/$bloblong/\/*(DEBLOBBED)*\//g;
}
p;
g;
s/^\\($falsepos[^\\n]*\\)//;
: list_matches_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b list_matches;

: list_blobs
$v:list_blobs
/^$falsepos/ {
  $v:print false positive
  # This is tricky.  We don't want to deblob the false positive.
  /^$falsepos[^\\n]*$blobfast/ {
    $v:print false positive immediately followed by blob
    h;
    s/^\\($falsepos\\)[^\\n]*$blobfast.*/\\1/;
    : list_blobs_match_loop
    /[\\n]/ {
      P;
      s/^[^\\n]*[\\n]//;
      x;
      s/^[^\\n]*[\\n]//;
      x;
      b list_blobs_match_loop;
    }
    G;
    b list_blobs_delete_to_eol;
  }
  h;
  s/^\\($falsepos[^\\n]*\\)[\\n].*/\\1/;
  p;
  g;
  s/^\\($falsepos[^\\n]*\\)//;
  b list_blobs_delete_to_eol;
}
/^[^\\n]*$blobfast/! {
  $v:print non-blob header
  h;
  s/[\\n]\\($falsepos\\|[^\\n]*$blobfast\\).*//;
  p;
  : list_blobs_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b list_blobs_nomatch_loop;
  }
  x;
  b list_blobs_delete_to_eol;
}
h;
s/^\\([^\\n]*\\($bloblong[^\\n]*\\)\\+\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
s/{\\($sepx\\)\\?$blobfseq\\($sepx\\)\\?}[ 	]*;/{\/*(DEBLOBBED)*\/};/g;
s/$bloblong/\/*(DEBLOBBED)*\//g;
p;
g;
s/^\\([^\\n]*\\($bloblong[^\\n]*\\)\\+\\)//;
: list_blobs_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b list_blobs;

: list_both
$v:list_both
/^\\($falsepos\\|[^\\n]*$blobfast\\)/! {
  $v:print non-blob header
  h;
  s/[\\n]\\($falsepos\\|[^\\n]*$blobfast\\).*//;
  p;
  : list_both_nomatch_loop
  /[\\n]/ {
    s/^[^\\n]*[\\n]//;
    x;
    s/^[^\\n]*[\\n]//;
    x;
    b list_both_nomatch_loop;
  }
  x;
  b list_both_delete_to_eol;
}
h;
s/^\\(\\($falsepos[^\\n]*\\|[^\\n]*$bloblong[^\\n]*\\)\\($bloblong[^\\n]*\\)*\\)\\([\\n].*\\)\\?$/\\1/;
$v:narrowed to blob
s/{\\($sepx\\)\\?$blobfseq\\($sepx\\)\\?}[ 	]*;/{\/*(DEBLOBBED)*\/};/g;
s/$bloblong/\/*(DEBLOBBED)*\//g;
p;
g;
s/^\\(\\($falsepos[^\\n]*\\|[^\\n]*$bloblong[^\\n]*\\)\\($bloblong[^\\n]*\\)*\\)//;
: list_both_delete_to_eol
$v:delete to eol
s/^[^\\n]*//;
/^$/d;
s/^[\\n]//;
b list_both;

"
}

# Process an input file named in $1 and run it through the blob
# recognizer.  Functions set_except and set_sed_cmd provide additional
# arguments on a per-file and per-action basis.

check () {
  case "$#" in 1) ;; *) echo ICE >&2; exit 1;; esac

  input=$1

  falsepos_name=`mktemp -t deblob-check-falsepos-XXXXXX`
  tempfiles="$falsepos_name"

  falseneg_name=`mktemp -t deblob-check-falseneg-XXXXXX`
  tempfiles="$tempfiles $falseneg_name"

  # Add $1 to falsepos.  Its usage makes it implicitly anchored to the
  # beginning of the line.  $2, if present, will some day narrow the
  # falsepos matches to files that match it.
  addx () {
    if test -n "$1"; then
      echo -n "\\|$1" >> $falsepos_name
    fi
  }

  # Add $1 to falseneg.  Unlike addx, it is NOT implicitly anchored to
  # the beginning of the line.  $2, if present, will some day narrow
  # the falseneg matches to files that match it.
  badx () {
    if test -n "$1"; then
      echo -n "\\|$1" >> $falseneg_name
    fi
  }

  set_except "$input"

  set_sed_cmd "$input"

  rm -f $tempfiles
  tempfiles=

  # Choose the input source...
  case $input in
  -) in= ;;
  *) in='< "$input"' ;;
  esac

  set fnord # shifted out below

  # Decompress as needed...
  case $input in
  *.bz2) cmd='bunzip2' ;;
  *.gz) cmd='gunzip' ;;
  *) cmd= ;;
  esac
  if test -n "$cmd"; then
    set "$@" "$cmd"
  fi

  # Extract or otherwise munge...
  case /$input in
  *.tar*)
    cmd="tar -xf - --to-command='echo \";/*begin \$TAR_FILENAME*/;\"; cat; echo \";/**/;\"; echo; echo \";/*end \$TAR_FILENAME*/;\"'"
    ;;
  *.patch | *.patch.*z* | */patch-* | *.diff | *.diff.*z*)
    if $reverse_patch; then
      s=- r=+
    else
      s=+ r=-
    fi
    sedpatch="
      /^[$r]/d;
      /^\\(@@\\|$s$s$s\\) / {
	i\\
;/**/;\\
;/*end patchlet */;\\
;/*begin patchlet */;
	s/^/;\\/*/;
	s/\$/*\\/;/;
      };
      s/^[ $s]//;"
    cmd='sed "$sedpatch"'
    ;;
  *)
    cmd='cat'
    ;;
  esac
  cmd="{ echo \";/*begin $input*/;\"; $cmd; echo; echo \";/*end $input*/;\"; }"
  set "$@" "$cmd"

  case $input in
  *.tar*)
    cmd="{ cat; cat > /dev/null; }"
    set "$@" "$cmd"
    ;;
  esac

  # Then run through the selected action.
  if test "$rm" != "rm -f" || test ! `echo "$sedmain" | wc -c` -lt 1024; then
    scriptname=`mktemp -t deblob-check-sedmain-XXXXXX`
    tempfiles="$tempfiles $scriptname"
    echo "$sedmain" > $scriptname
    cmd="sed -n -f \"$scriptname\""
  else
    cmd='sed -n "$sedmain"'
  fi
  set "$@" "$cmd"

  test $# != 1 || set "$@" "cat"

  shift # fnord goes out here

  pipe=
  for cmd
  do
    if test -z "$pipe"; then
      pipe="$cmd $in"
    else
      pipe="$pipe | $cmd"
    fi
  done

  eval "$pipe"
  status=$?

  $rm $tempfiles
  tempfiles=

  (exit $status)
}

# If no input given, use stdin.
case $# in
0)
  test -t 0 && echo reading from standard input >&2
  set fnord -
  shift
  ;;
esac

# The lines below commented out out #list: can be used to get a list
# of matching inputs.  ATM this is useless, so we just use a shell
# boolean.

#list: n=$#
pass=:

tempfiles=
trap "status=$?; test -z \"$tempfiles\" || rm -f $tempfiles; (exit $status); exit" 0 1 2 15

process_arg=

# Go through each of the input files in the command line.
for file
do
  case $process_arg in
  "") ;;
  --implied-prefix | --prefix | -i)
    prefix=$file
    case $prefix in
    /*/) ;;
    */) prefix=/$prefix ;;
    /*) prefix=$prefix/ ;;
    *) prefix=/$prefix/ ;;
    esac
    process_arg=
    continue
    ;;
  *)
    echo Internal error with process_arg=$process_arg >&2
    exit 1
    ;;
  esac

  case $sawdashdash$file in
  --implied-prefix | --prefix | -i)
    process_arg=$file
    continue
    ;;
  esac
  
  # If we print anything whatsoever (even a blank line) while
  # processing it, we've failed.
  if check "$file"; then
    :
  else
    pass=false
    #list: set fnord "$@" "$file"
    #list: shift
  fi
done

case $process_arg in
"") ;;
*)
  echo Missing argument to $process_arg >&2
  exit 1
  ;;
esac

#list: shift $n

#list: exec test $# = 0
$pass
exit
